{"version":3,"file":"DT.min.js","sources":["../../assets_source/js/DT.js"],"names":["Fireworks","debug","EffectsStackBuilder","emitter","this","_emitter","prototype","back","createEffect","name","opts","creator","pushTo","effect","undefined","Effect","methods","onCreate","val","onBirth","onUpdate","onDeath","onPreUpdate","onPreRender","onRender","onPostRender","onIntensityChange","effects","push","value","destroy","createEmitter","Emitter","_nParticles","nParticles","_particles","_effects","_started","_onUpdated","_intensity","_maxDeltaTime","_effectsStackBuilder","forEach","particle","i","length","particles","liveParticles","_liveParticles","deadParticles","_deadParticles","effectsStackBuilder","intensity","console","assert","oldValue","bind","maxDeltaTime","setParticleData","namespace","getParticleData","start","Array","Particle","slice","particleIdx","update","deltaTime","Math","min","render","killParticle","idx","indexOf","splice","spawnParticle","pop","createLinearGradient","LinearGradient","_keyPoints","x","y","get","keyPoint","prev","next","ratio","set","key","has","Shape","createVector","z","Vector","constructor","setX","setY","setZ","random","toString","JSON","stringify","copy","v","add","a","b","addSelf","addScalar","s","sub","subSelf","multiply","multiplySelf","multiplyScalar","divideSelf","divideScalar","negate","dot","lengthSq","sqrt","normalize","setLength","l","cross","crossSelf","distanceTo","distanceToSquared","equals","isZero","clone","acceleration","effectId","shape","vector","randomPoint","velocity","friction","data","lifeTime","minAge","maxAge","curAge","normalizedAge","position","radialVelocity","minSpeed","maxSpeed","randomVelocityDrift","drift","speed","createShapeBox","positionX","positionY","positionZ","sizeX","sizeY","sizeZ","size","Box","_vector","contains","point","delta","abs","createShapePoint","Point","createShapeSphere","radius","ShapeSphere","distance","spawnerOneShot","nSent","spawning","reset","stop","amount","spawnerSteadyRate","rate","nToCreate","floor","renderToCanvas","buildDefaultContext","canvas","document","createElement","width","window","innerWidth","height","innerHeight","body","appendChild","style","left","top","ctx","getContext","ctorTypeArc","beginPath","arc","PI","fill","ctorTypeDrawImage","images","Image","src","image","scale","opacity","rotation","canonAge","imageIdx","save","translate","rotate","globalAlpha","drawImage","offsetX","offsetY","restore","type","renderToThreejsObject3D","container","threejsObject3D","object3d","create","THREE","Object3D","remove","renderToThreejsParticleSystem","defaultParticleSystem","geometry","Geometry","vertices","Vector3","material","ParticleBasicMaterial","sizeAttenuation","color","map","generateTexture","blending","AdditiveBlending","depthWrite","transparent","particleSystem","ParticleSystem","dynamic","sortParticles","context","gradient","createRadialGradient","addColorStop","closePath","fillStyle","texture","Texture","needsUpdate","threejsParticle","vertex","Infinity","bindTriggerDomEvents","domElement","BindTriggerDomEvents","_domElement","_onMouseDown","_onMouseUp","addEventListener","_onMouseWheel","event","wheelDelta","max","removeEventListener","DatGui4Emitter","gui","dat","GUI","effectName","keys","Object","filter","folder","addFolder","ProceduralTextures","buildTexture","Detector","CanvasRenderingContext2D","webgl","WebGLRenderingContext","e","workers","Worker","fileapi","File","FileReader","FileList","Blob","getWebGLErrorMessage","element","id","fontFamily","fontSize","fontWeight","textAlign","background","padding","margin","innerHTML","join","addGetWebGLMessage","parameters","parent","THREEx","WindowResize","renderer","camera","callback","setSize","aspect","updateProjectionMatrix","trigger","Stats","Date","now","m","g","n","o","h","p","q","r","f","preventDefault","t","cssText","c","children","j","d","k","display","REVISION","setMode","begin","end","textContent","firstChild","round","AudioContext","webkitAudioContext","WebAudio","isAvailable","_addRequiredMessage","Error","_ctx","_muted","_volume","_gainNode","createGain","_compressor","createDynamicsCompressor","connect","destination","_pageVisibilityCtor","fn","_pageVisibilityDtor","createSound","webaudio","sound","Sound","_entryNode","volume","gain","mute","toggleMute","_pageVisibilityEventStr","hidden","mozHidden","msHidden","webkitHidden","_pageVisibilityDocumentStr","_$pageVisibilityCallback","isHidden","NodeChainBuilder","audioContext","_context","_firstNode","_lastNode","_nodes","nodes","first","last","_addNode","node","properties","lastIsBufferSource","_bufferSourceDst","property","cloneBufferSource","bufferSource","orig","createBufferSource","buffer","playbackRate","loop","mediaStreamSource","stream","createMediaStreamSource","mediaElementSource","HTMLAudioElement","HTMLVideoElement","createMediaElementSource","panner","createPanner","analyser","createAnalyser","gainNode","nodeChain","_webaudio","_chain","_source","_analyser","_panner","disconnect","isPlayable","play","time","clonedNode","source","pannerCone","innerAngle","outerAngle","outerGain","coneInnerAngle","coneOuterAngle","coneOuterGain","pannerConeInnerAngle","pannerConeOuterAngle","pannerConeOuterGain","amplitude","freqByte","Uint8Array","frequencyBinCount","getByteFrequencyData","sum","tone","hertz","seconds","nChannels","sampleRate","createBuffer","fArray","getChannelData","angle","sin","makeHistogram","nBar","_privHisto","freqData","makeHisto","srcArr","dstLength","barW","arr","arrIdx","average","histo","load","url","onSuccess","onError","warn","_loadAndDecodeSound","onLoad","request","XMLHttpRequest","open","responseType","onload","decodeAudioData","response","send","Flow","self","stack","timerId","setTimeout","_next","clearTimeout","par","isSeq","seq","err","result","errors","results","callbacks","shift","nbReturn","fct","index","error","FullScreen","available","_hasWebkitFullScreen","_hasMozFullScreen","activated","webkitIsFullScreen","mozFullScreen","webkitRequestFullScreen","Element","ALLOW_KEYBOARD_INPUT","mozRequestFullScreen","cancel","webkitCancelFullScreen","mozCancelFullScreen","bindKey","charCode","charCodeAt","dblclick","toggle","__bind","me","apply","arguments","onKeyPress","which","unbind","AnaglyphEffect","_aspect","_near","_far","_fov","eyeRight","Matrix4","eyeLeft","_cameraL","PerspectiveCamera","matrixAutoUpdate","_cameraR","_camera","OrthographicCamera","_scene","Scene","_params","minFilter","LinearFilter","magFilter","NearestFilter","format","RGBAFormat","_renderTargetL","WebGLRenderTarget","_renderTargetR","_material","ShaderMaterial","uniforms","mapLeft","mapRight","vertexShader","fragmentShader","mesh","Mesh","PlaneGeometry","dispose","scene","updateMatrixWorld","hasCameraChanged","near","far","fov","xmin","xmax","projectionMatrix","eyeSep","eyeSepOnProjection","ymax","tan","degToRad","elements","matrixWorld","DT","$","requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","cancelAnimFrame","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","oCancelAnimationFrame","msCancelAnimationFrame","getCookie","matches","cookie","match","RegExp","replace","decodeURIComponent","getDistance","x1","y1","z1","x2","y2","z2","genCoord","offset","game","param","spacing","absX","genRandomFloorBetween","rand","genRandomBetween","genRandomSign","signVal","animate","nowMsec","lastTimeMsec","deltaMsec","WebGLRenderer","physicallyBasedShading","lens","lights","light","PointLight","directionalLight","DirectionalLight","bgTexture","ImageUtils","loadTexture","backgroundMesh","MeshBasicMaterial","depthTest","visible","on","player","isFun","animation","camOffset","camDelta","lensOffset","lensDelta","getChanger","setLens","IcosahedronGeometry","detail","el","faces","PolyhedronGeometry","call","listOfModels","loadModel","loader","JSONLoader","modelObj","materials","MeshLambertMaterial","morphTargets","emissive","MeshFaceMaterial","events","startGame","pauseGame","resumeGame","resetGame","changeSpeed","makeFun","stopFun","changeHelth","showHelth","changeScore","showScore","blink","focus","blur","Game","spawnCoord","opacityCoord","dieCoord","stonesCloseness","globalVolume","prevGlobalVolume","changer","step","increase","setChanger","getValue","wasStarted","wasPaused","wasOver","wasMuted","timer","updateTimer","sec","html","gameOver","Player","options","__instance","currentHelth","currentScore","destPoint","isInvulnerability","invulnerTimer","funTimer","sphere","SphereGeometry","MeshPhongMaterial","Color","frames","framesLeft","dr","dg","db","doBlink","defClr","setHSL","getHex","vertexColors","colors","updateBlink","setRGB","helth","makeInvulner","invulner","stopInvulner","score","updateInvulnerability","updateFun","changeDestPoint","dy","dx","moveSphere","iterator","aix","bump","amp","audio","valueAudio","GameObject","tObject","THREEConstructor","addToScene","removeFromScene","log","createAndAdd","updateGeometry","updateMaterial","updateParam","prop","hasOwnProperty","setParam","GameCollectionObject","collection","shading","FlatShading","ind","Shield","shield","CubeGeometry","Dust","number","verticesNeedUpdate","dust","ParticleSystemMaterial","Stone","depth","part","specular","shininess","distanceToSphere","minDistance","sounds","stoneDestroy","sendSocketMessage","hit","stoneMiss","Coin","coin_sides_geo","CylinderGeometry","coin_cap_geo","xCosA","cos","a1","faceVertexUvs","Vector2","Face3","computeCentroids","computeFaceNormals","coin_cap_texture","coin_sides_mat","coin_sides","coin_cap_mat","coin_cap_top","coin_cap_bottom","zAngle","positon","distanceBerweenCenters","catchCoin","Bonus","MorphAnimation","Collection","createObjects","removeObjects","ei","StonesCollection","dist","CoinsCollection","BonusesCollection","caughtBonuses","useBonuses","catchBonus","refreshBonus","frequency",1,"gameover","pause","music",2,"started","startedAt","pausedAt","stopped","paused","setVolume","gainNodes","stopSound","playSound","stopSoundBeforPause","playSoundAfterPause","counter","buffers","sources","analysers","freqDomain","Audio","canPlayOgg","canPlayType","alert","fftSize","minDecibels","maxDecibels","visualize","initSound","arrayBuffer","bufferIndex","decodedArrayBuffer","yepnope","showLoading","ext","loadSoundFile","urlArr","xhr","getFrequencyValue","nyquist","initKeyboardControl","keydown","keyCode","keyup","handlers","pauseOnSpace","restartOnSpace","server","location","origin","initSocket","leftBreakThreshold","leftTurnThreshold","rightBreakThreshold","rightTurnThreshold","socket","io","emit","cookieUID","gameCode","hide","startAfterChooseControl","turn","click","sessionid","coinsCollect","initPhoneControl","enableWebcam","gotStream","camvideo","URL","createObjectURL","onerror","onended","noStream","msg","code","video","readyState","HAVE_ENOUGH_DATA","videoContext","videoCanvas","blend","sourceData","getImageData","lastImageData","blendedData","createImageData","differenceAccuracy","blendContext","putImageData","target","data1","data2","average1","average2","diff","threshold","fastAbs","checkAreas","buttons","w","countPixels","coord","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","webkitURL","getElementById","css","blendCanvas","background-color","margin-left","fillRect","button1","buttonData1","button2","buttonData2","button3","buttonData3","startOnSpace","restart","fullscreen","isActivated","right","runApp","fadeOut","text","fadeIn","setStats","getElementsByTagName","stats","zIndex","stats2"],"mappings":"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","sourcesContent":["\n\n/**\n * Global namespace for the whole library\n * @namespace Global namespace for the whole library\n * @type {Object}\n */\nvar Fireworks\t= {};\n\n/**\n * enable or disable debug in the library\n * @type {Boolean}\n */\nFireworks.debug\t= true;//////////////////////////////////////////////////////////////////////////////////\n//\t\t\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\nFireworks.EffectsStackBuilder\t= function(emitter){\n\tthis._emitter\t= emitter;\n};\n\n/**\n * Getter for the emitter \n*/\nFireworks.EffectsStackBuilder.prototype.emitter\t= function(){\n\treturn this._emitter;\t\n};\n\nFireworks.EffectsStackBuilder.prototype.back\t= function(){\n\treturn this._emitter;\n}\n\nFireworks.EffectsStackBuilder.prototype.createEffect\t= function(name, opts){\n\tvar creator\t= Fireworks.createEffect(name, opts).pushTo(this._emitter).back(this);\n\tcreator.effect().emitter(this._emitter);\n\treturn creator;\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\t\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * Basic Fireworks.Effect builder\n*/\nFireworks.createEffect\t= function(name, opts){\n\t// handle polymophism\n\tif( typeof(name) === 'object' ){\n\t\topts\t= name;\n\t\tname\t= undefined;\n\t}\n\t\n\tvar effect\t= new Fireworks.Effect();\n\teffect.opts\t= opts;\n\teffect.name\t= name;\n\teffect.back\t= null;\n\tvar methods\t= {\n\t\tonCreate: function(val){\n\t\t\teffect.onCreate\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonBirth: function(val){\n\t\t\teffect.onBirth\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonUpdate: function(val){\n\t\t\teffect.onUpdate\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonDeath: function(val){\n\t\t\teffect.onDeath\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonPreUpdate: function(val){\n\t\t\teffect.onPreUpdate\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonPreRender: function(val){\n\t\t\teffect.onPreRender\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonRender: function(val){\n\t\t\teffect.onRender\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonPostRender: function(val){\n\t\t\teffect.onPostRender\t= val;\n\t\t\treturn methods;\n\t\t},\n\t\tonIntensityChange: function(val){\n\t\t\teffect.onIntensityChange= val;\n\t\t\treturn methods;\n\t\t},\n\t\tpushTo\t: function(emitter){\n\t\t\temitter.effects().push(effect);\n\t\t\treturn methods;\t\n\t\t},\n\t\tback\t: function(value){\n\t\t\tif( value === undefined )\treturn effect.back;\t\n\t\t\teffect.back\t= value;\n\t\t\treturn methods;\t\n\t\t},\n\t\teffect\t: function(){\n\t\t\treturn effect;\n\t\t}\n\t}\n\treturn methods;\n}\n\n/**\n * An effect to apply on particles\n*/\nFireworks.Effect\t= function(){\n\tthis._emitter\t= null;\n}\n\nFireworks.Effect.prototype.destroy\t= function(){\n}\n\n/**\n * Getter/Setter for the emitter \n*/\nFireworks.Effect.prototype.emitter\t= function(value){\n\tif( value === undefined )\treturn this._emitter;\t\n\tthis._emitter\t= value;\n\treturn this;\t\n};\n\n/**\n * Callback called on particle creation\n*/\n//Fireworks.Effect.prototype.onCreate\t= function(){\n//}\n//\n/**\n * Callback called when a particle is spawning\n *\n * TODO to rename onSpawn\n*/\n//Fireworks.Effect.prototype.onBirth\t= function(){\n//}\n//\n//Fireworks.Effect.prototype.onDeath\t= function(){\n//}\n//\n//Fireworks.Effect.prototype.onUpdate\t= function(){\n//}\n\nFireworks.createEmitter\t= function(opts){\n\treturn new Fireworks.Emitter(opts);\n}\n\n/**\n * The emitter of particles\n*/\nFireworks.Emitter\t= function(opts){\n\tthis._nParticles\t= opts.nParticles !== undefined ? opts.nParticles : 100;\n\tthis._particles\t\t= [];\n\tthis._effects\t\t= [];\n\tthis._started\t\t= false;\n\tthis._onUpdated\t\t= null;\n\tthis._intensity\t\t= 0;\n\tthis._maxDeltaTime\t= 1/3;\n\n\tthis._effectsStackBuilder\t= new Fireworks.EffectsStackBuilder(this)\n}\n\nFireworks.Emitter.prototype.destroy\t= function()\n{\n\tthis._effects.forEach(function(effect){\n\t\teffect.destroy();\n\t});\n\tthis._particles.forEach(function(particle){\n\t\tparticle.destroy();\n\t});\n}\n\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tGetters\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\nFireworks.Emitter.prototype.effects\t= function(){\n\treturn this._effects;\n}\nFireworks.Emitter.prototype.effect\t= function(name){\n\tfor(var i = 0; i < this._effects.length; i++){\n\t\tvar effect\t= this._effects[i];\n\t\tif( effect.name === name )\treturn effect;\n\t}\n\treturn null;\n}\n\nFireworks.Emitter.prototype.particles\t= function(){\n\treturn this._particles;\n}\nFireworks.Emitter.prototype.liveParticles\t= function(){\n\treturn this._liveParticles;\n}\nFireworks.Emitter.prototype.deadParticles\t= function(){\n\treturn this._deadParticles;\n}\nFireworks.Emitter.prototype.nParticles\t= function(){\n\treturn this._nParticles;\n}\n\nFireworks.Emitter.prototype.effectsStackBuilder\t= function(){\n\treturn this._effectsStackBuilder;\n}\n\n\n/**\n * Getter/setter for intensity\n*/\nFireworks.Emitter.prototype.intensity\t= function(value){\n\t// if it is a getter, return value\n\tif( value === undefined )\treturn this._intensity;\n\t// if the value didnt change, return for chained api\n\tif( value === this._intensity )\treturn this;\n\t// sanity check\n\tFireworks.debug && console.assert( value >= 0, 'Fireworks.Emitter.intensity: invalid value.', value);\n\tFireworks.debug && console.assert( value <= 1, 'Fireworks.Emitter.intensity: invalid value.', value);\n\t// backup the old value\n\tvar oldValue\t= this._intensity;\n\t// update the value\n\tthis._intensity\t= value;\n\t// notify all effects\n\tthis._effects.forEach(function(effect){\n\t\tif( !effect.onIntensityChange )\treturn;\n\t\teffect.onIntensityChange(this._intensity, oldValue);\t\t\t\n\t}.bind(this));\n\treturn this;\t// for chained API\n}\n\n/**\n * Getter/setter for intensity\n*/\nFireworks.Emitter.prototype.maxDeltaTime\t= function(value){\n\tif( value === undefined )\treturn this._maxDeltaTime;\n\tthis._maxDeltaTime\t= value;\n\treturn this;\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tbackward compatibility\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\nFireworks.Emitter.prototype.setParticleData\t= function(particle, namespace, value){\n\tparticle[namespace] = value;\n}\n\nFireworks.Emitter.prototype.getParticleData\t= function(particle, namespace){\n\treturn particle[namespace];\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tStart function\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\nFireworks.Emitter.prototype.start\t= function()\n{\n\tconsole.assert( this._effects.length > 0, \"At least one effect MUST be set\")\n\tconsole.assert( this._started === false );\n\t\n\tthis._particles\t\t= new Array(this._nParticles);\n\tfor(var i = 0; i < this._nParticles; i++){\n\t\tthis._particles[i]\t= new Fireworks.Particle();\n\t}\n\n\tthis._liveParticles\t= [];\n\tthis._deadParticles\t= this._particles.slice(0);\n\tthis._started\t\t= true;\n\n\t// onCreate on all particles\n\tthis._effects.forEach(function(effect){\n\t\tif( !effect.onCreate )\treturn;\n\t\tthis._particles.forEach(function(particle, particleIdx){\n\t\t\teffect.onCreate(particle, particleIdx);\t\t\t\n\t\t})\n\t}.bind(this));\n\t// set the intensity to 1\n\tthis.intensity(1)\n\n\treturn this;\t// for chained API\n}\n\nFireworks.Emitter.prototype.update\t= function(deltaTime){\n\t// bound the deltaTime to this._maxDeltaTime\n\tdeltaTime\t= Math.min(this._maxDeltaTime, deltaTime)\n\t// honor effect.onPreUpdate\n\tthis._effects.forEach(function(effect){\n\t\tif( !effect.onPreUpdate )\treturn;\n\t\teffect.onPreUpdate(deltaTime);\t\t\t\n\t}.bind(this));\n\t// update each particles\n\tthis._effects.forEach(function(effect){\n\t\tif( !effect.onUpdate )\treturn;\n\t\tthis._liveParticles.forEach(function(particle){\n\t\t\teffect.onUpdate(particle, deltaTime);\t\t\t\n\t\t})\n\t}.bind(this));\n\treturn this;\t// for chained API\n}\n\nFireworks.Emitter.prototype.render\t= function(){\n\tthis._effects.forEach(function(effect){\n\t\tif( !effect.onPreRender )\treturn;\n\t\teffect.onPreRender();\t\t\t\n\t}.bind(this));\n\tthis._effects.forEach(function(effect){\n\t\tif( !effect.onRender )\treturn;\n\t\tthis._liveParticles.forEach(function(particle){\n\t\t\teffect.onRender(particle);\t\t\t\n\t\t})\n\t}.bind(this));\n\tthis._effects.forEach(function(effect){\n\t\tif( !effect.onPostRender )\treturn;\n\t\teffect.onPostRender();\t\t\t\n\t}.bind(this));\n\treturn this;\t// for chained API\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\t\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * kill this particle\n*/\nFireworks.Emitter.prototype.killParticle\t= function(particle)\n{\n\tvar idx\t= this._liveParticles.indexOf(particle);\n\t// sanity check\n\tFireworks.debug && console.assert( idx !== -1 );\n\tthis._liveParticles.splice(idx, 1)\n\tthis._deadParticles.push(particle);\n\t// do the death on all effects\n\tthis.effects().forEach(function(effect){\n\t\teffect.onDeath && effect.onDeath(particle);\t\t\t\n\t}.bind(this));\n}\n\n/**\n * Spawn a particle\n*/\nFireworks.Emitter.prototype.spawnParticle\t= function(){\n\t// sanity check\n\tFireworks.debug && console.assert(this._deadParticles.length >= 1, 'no more particle available' );\n\t// change the particles \n\tvar particle\t= this.deadParticles().pop();\n\tthis.liveParticles().push(particle);\n\t// do the birth on all effects\n\tthis.effects().forEach(function(effect){\n\t\teffect.onBirth && effect.onBirth(particle);\t\t\t\n\t}.bind(this));\n}\nFireworks.createLinearGradient\t= function(opts){\n\tvar LinearGradient\t= new Fireworks.LinearGradient(opts);\n\treturn LinearGradient;\n}\n\n/**\n * The emitter of particles\n*/\nFireworks.LinearGradient\t= function(opts){\n\tthis._keyPoints\t= [];\n}\n\nFireworks.LinearGradient.prototype.push\t= function(x, y){\n\tthis._keyPoints.push({\n\t\tx\t: x,\n\t\ty\t: y\n\t});\n\treturn this;\n}\n\n/**\n * Compute a value for this LinearGradient\n*/\nFireworks.LinearGradient.prototype.get\t= function(x){\n\tfor( var i = 0; i < this._keyPoints.length; i++ ){\n\t\tvar keyPoint\t= this._keyPoints[i];\n\t\tif( x <= keyPoint.x )\tbreak;\n\t}\n\n\tif( i === 0 )\treturn this._keyPoints[0].y;\n\n\t// sanity check\n\tFireworks.debug && console.assert(i < this._keyPoints.length );\n\n\tvar prev\t= this._keyPoints[i-1];\n\tvar next\t= this._keyPoints[i];\n\t\n\tvar ratio\t= (x - prev.x) / (next.x - prev.x)\n\tvar y\t\t= prev.y + ratio * (next.y - prev.y)\n\t\n\treturn y;\n};\n/**\n * The emitter of particles\n*/\nFireworks.Particle\t= function(){\n}\n\nFireworks.Particle.prototype.set\t= function(key, value){\n\t// sanity check\n\tFireworks.debug && console.assert( this[key] === undefined, \"key already defined: \"+key );\n\t\n\tthis[key]\t= value;\n\treturn this[key];\n}\n\nFireworks.Particle.prototype.get\t= function(key){\n\tFireworks.debug && console.assert( this[key] !== undefined, \"key undefined: \"+key );\n\treturn this[key];\n}\n\nFireworks.Particle.prototype.has\t= function(key){\n\treturn this[key] !== undefined\t? true : false;\n}\nFireworks.Shape\t= function(){\n}\n\n///**\n// * @param {Fireworks.Vector} point the point coordinate to test\n// * @returns {Boolean} true if point is inside the shape, false otherwise\n//*/\n//Fireworks.Shape.prototype.contains\t= function(point){\n//}\n//\n///**\n// * generate a random point contained in this shape\n// * @returns {Fireworks.Vector} the just generated random point\n//*/\n//Firefly.Shape.prototype.randomPoint\t= function(vector){\n//}\nFireworks.createVector = function(x, y, z){\n\treturn new Fireworks.Vector(x,y,z);\n};\n\n/**\n * jme- copy of THREE.Vector3 https://github.com/mrdoob/three.js/blob/master/src/core/Vector3.js\n *\n * @author mr.doob / http://mrdoob.com/\n * @author kile / http://kile.stravaganza.org/\n * @author philogb / http://blog.thejit.org/\n * @author mikael emtinger / http://gomo.se/\n * @author egraether / http://egraether.com/\n */\n\nFireworks.Vector = function ( x, y, z ) {\n\n\tthis.x = x || 0;\n\tthis.y = y || 0;\n\tthis.z = z || 0;\n\n};\n\n\nFireworks.Vector.prototype = {\n\n\tconstructor: Fireworks.Vector,\n\n\tset: function ( x, y, z ) {\n\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\n\t\treturn this;\n\n\t},\n\n\tsetX: function ( x ) {\n\n\t\tthis.x = x;\n\n\t\treturn this;\n\n\t},\n\n\tsetY: function ( y ) {\n\n\t\tthis.y = y;\n\n\t\treturn this;\n\n\t},\n\n\tsetZ: function ( z ) {\n\n\t\tthis.z = z;\n\n\t\treturn this;\n\n\t},\n\t\n\trandom\t: function( ) {\n\t\tthis.x\t= Math.random() - 0.5;\n\t\tthis.y\t= Math.random() - 0.5;\n\t\tthis.z\t= Math.random() - 0.5;\n\t\treturn this;\n\t}, // jme - added\n\t\n\ttoString\t: function(){\n\t\treturn JSON.stringify(this);\n\t}, // jme - added\n\n\tcopy: function ( v ) {\n\n\t\tthis.x = v.x;\n\t\tthis.y = v.y;\n\t\tthis.z = v.z;\n\n\t\treturn this;\n\n\t},\n\n\tadd: function ( a, b ) {\n\n\t\tthis.x = a.x + b.x;\n\t\tthis.y = a.y + b.y;\n\t\tthis.z = a.z + b.z;\n\n\t\treturn this;\n\n\t},\n\n\taddSelf: function ( v ) {\n\n\t\tthis.x += v.x;\n\t\tthis.y += v.y;\n\t\tthis.z += v.z;\n\n\t\treturn this;\n\n\t},\n\n\taddScalar: function ( s ) {\n\n\t\tthis.x += s;\n\t\tthis.y += s;\n\t\tthis.z += s;\n\n\t\treturn this;\n\n\t},\n\n\tsub: function ( a, b ) {\n\n\t\tthis.x = a.x - b.x;\n\t\tthis.y = a.y - b.y;\n\t\tthis.z = a.z - b.z;\n\n\t\treturn this;\n\n\t},\n\n\tsubSelf: function ( v ) {\n\n\t\tthis.x -= v.x;\n\t\tthis.y -= v.y;\n\t\tthis.z -= v.z;\n\n\t\treturn this;\n\n\t},\n\n\tmultiply: function ( a, b ) {\n\n\t\tthis.x = a.x * b.x;\n\t\tthis.y = a.y * b.y;\n\t\tthis.z = a.z * b.z;\n\n\t\treturn this;\n\n\t},\n\n\tmultiplySelf: function ( v ) {\n\n\t\tthis.x *= v.x;\n\t\tthis.y *= v.y;\n\t\tthis.z *= v.z;\n\n\t\treturn this;\n\n\t},\n\n\tmultiplyScalar: function ( s ) {\n\n\t\tthis.x *= s;\n\t\tthis.y *= s;\n\t\tthis.z *= s;\n\n\t\treturn this;\n\n\t},\n\n\tdivideSelf: function ( v ) {\n\n\t\tthis.x /= v.x;\n\t\tthis.y /= v.y;\n\t\tthis.z /= v.z;\n\n\t\treturn this;\n\n\t},\n\n\tdivideScalar: function ( s ) {\n\n\t\tif ( s ) {\n\n\t\t\tthis.x /= s;\n\t\t\tthis.y /= s;\n\t\t\tthis.z /= s;\n\n\t\t} else {\n\n\t\t\tthis.x = 0;\n\t\t\tthis.y = 0;\n\t\t\tthis.z = 0;\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\n\tnegate: function() {\n\n\t\treturn this.multiplyScalar( - 1 );\n\n\t},\n\n\tdot: function ( v ) {\n\n\t\treturn this.x * v.x + this.y * v.y + this.z * v.z;\n\n\t},\n\n\tlengthSq: function () {\n\n\t\treturn this.x * this.x + this.y * this.y + this.z * this.z;\n\n\t},\n\n\tlength: function () {\n\n\t\treturn Math.sqrt( this.lengthSq() );\n\n\t},\n\n\tnormalize: function () {\n\n\t\treturn this.divideScalar( this.length() );\n\n\t},\n\n\tsetLength: function ( l ) {\n\n\t\treturn this.normalize().multiplyScalar( l );\n\n\t},\n\t\n\tcross: function ( a, b ) {\n\n\t\tthis.x = a.y * b.z - a.z * b.y;\n\t\tthis.y = a.z * b.x - a.x * b.z;\n\t\tthis.z = a.x * b.y - a.y * b.x;\n\n\t\treturn this;\n\n\t},\n\n\tcrossSelf: function ( v ) {\n\n\t\tvar x = this.x, y = this.y, z = this.z;\n\n\t\tthis.x = y * v.z - z * v.y;\n\t\tthis.y = z * v.x - x * v.z;\n\t\tthis.z = x * v.y - y * v.x;\n\n\t\treturn this;\n\n\t},\n\n\tdistanceTo: function ( v ) {\n\n\t\treturn Math.sqrt( this.distanceToSquared( v ) );\n\n\t},\n\n\tdistanceToSquared: function ( v ) {\n\n\t\treturn new Fireworks.Vector().sub( this, v ).lengthSq();\n\n\t},\n\n\tequals: function ( v ) {\n\n\t\treturn ( ( v.x === this.x ) && ( v.y === this.y ) && ( v.z === this.z ) );\n\n\t},\n\n\tisZero: function () {\n\n\t\treturn ( this.lengthSq() < 0.0001 /* almostZero */ );\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new Fireworks.Vector( this.x, this.y, this.z );\n\n\t}\n\n};\n/**\n * Shortcut to create Fireworks.EffectRandomDriftVelocity\n*/\nFireworks.EffectsStackBuilder.prototype.acceleration\t= function(opts)\n{\n\topts\t\t= opts\t\t|| {};\n\tvar effectId\t= opts.effectId\t|| 'acceleration';\n\tconsole.assert( opts.shape instanceof Fireworks.Shape );\n\t// create the effect itself\n\tFireworks.createEffect(effectId, {\n\t\tshape\t: opts.shape\n\t}).onCreate(function(particle){\n\t\tparticle.acceleration = {\n\t\t\tvector\t: new Fireworks.Vector()\n\t\t};\n\t}).onBirth(function(particle){\n\t\tvar acceleration= particle.acceleration.vector;\n\t\tthis.opts.shape.randomPoint(acceleration)\n\t}).onUpdate(function(particle, deltaTime){\n\t\tvar velocity\t= particle.velocity.vector;\n\t\tvar acceleration= particle.acceleration.vector;\n\t\tvelocity.x\t+= acceleration.x * deltaTime;\n\t\tvelocity.y\t+= acceleration.y * deltaTime;\n\t\tvelocity.z\t+= acceleration.z * deltaTime;\n\t}).pushTo(this._emitter);\n\n\treturn this;\t// for chained API\n};\n/**\n * Handle the friction - aka a value between 0 and 1 which multiply the velocity\n *\n * @param {Number} value the friction number between 0 and 1\n*/\nFireworks.EffectsStackBuilder.prototype.friction = function(value)\n{\n\t// handle parameter polymorphism\n\tvalue = value !== undefined ? value : 1;\n\t// sanity check\n\tconsole.assert( value >= 0 && value <= 1.0 );\n\t// create the effect itself\n\tFireworks.createEffect('friction')\n\t.onCreate(function(particle, particleIdx){\n\t\tparticle.friction = {\n\t\t\tvalue: value\n\t\t};\n\t})\n\t.onBirth(function(particle){\n\t\tvar data = particle.friction;\n\t\tdata.value = value\n\t})\n\t.onUpdate(function(particle){\n\t\tvar friction = particle.friction.value;\n\t\tvar velocity = particle.velocity.vector;\n\t\tvelocity.multiplyScalar(friction);\n\t})\n\t.pushTo(this._emitter);\n\t// return this for chained API\n\treturn this;\n};\n/**\n * Shortcut to create Fireworks.EffectRandomDriftVelocity\n*/\nFireworks.EffectsStackBuilder.prototype.lifeTime = function(minAge, maxAge)\n{\n\t// sanity check\n\tconsole.assert( minAge !== undefined )\n\t// if maxAge isnt \n\tif( maxAge === undefined )\tmaxAge\t= minAge;\n\tconsole.assert( maxAge !== undefined )\n\t// create the effect itself\n\tvar emitter\t= this._emitter;\n\tFireworks.createEffect('lifeTime', {\n\t\tminAge\t: minAge,\n\t\tmaxAge\t: maxAge\n\t}).onCreate(function(particle){\n\t\tvar data\t= particle.lifeTime = {\n\t\t\tcurAge\t: 0,\n\t\t\tminAge\t: 0,\n\t\t\tmaxAge\t: 0,\n\t\t\tnormalizedAge\t: function(){\n\t\t\t\treturn (data.curAge - data.minAge) / (data.maxAge - data.minAge);\n\t\t\t}\n\t\t};\n\t}).onBirth(function(particle){\n\t\tvar lifeTime\t= particle.lifeTime;\n\t\tlifeTime.curAge\t= 0;\n\t\tlifeTime.maxAge\t= this.opts.minAge + Math.random() * (this.opts.maxAge - this.opts.minAge);\n\t}).onUpdate(function(particle, deltaTime){\n\t\tvar lifeTime\t= particle.lifeTime;\n\t\tlifeTime.curAge\t+= deltaTime;\n\t\tif( lifeTime.curAge > lifeTime.maxAge )\temitter.killParticle(particle);\n\t}).pushTo(this._emitter);\n\t// return this for chained API\n\treturn this;\n};\n/**\n * Shortcut to create Fireworks.EffectRandomDriftVelocity\n*/\nFireworks.EffectsStackBuilder.prototype.position = function(shape)\n{\n\tconsole.assert( shape instanceof Fireworks.Shape );\n\tFireworks.createEffect('position', {\n\t\tshape: shape\n\t}).onCreate(function(particle){\n\t\tparticle.position = {\n\t\t\tvector: new Fireworks.Vector()\n\t\t};\n\t}).onBirth(function(particle){\n\t\tvar position = particle.position.vector;\n\t\tthis.opts.shape.randomPoint(position)\n\t}).pushTo(this._emitter);\n\treturn this; // for chained API\n};\n/**\n * Shortcut to create Fireworks.EffectRandomDriftVelocity\n*/\nFireworks.EffectsStackBuilder.prototype.radialVelocity = function(minSpeed, maxSpeed)\n{\n\tFireworks.createEffect('radialVelocity', {\n\t\tminSpeed: minSpeed,\n\t\tmaxSpeed: maxSpeed\n\t}).onCreate(function(particle){\n\t\tparticle.velocity = {\n\t\t\tvector: new Fireworks.Vector()\n\t\t};\n\t}).onBirth(function(particle, deltaTime){\n\t\tvar position = particle.position.vector;\n\t\tvar velocity = particle.velocity.vector;\n\t\tvar length = this.opts.minSpeed + (this.opts.maxSpeed - this.opts.minSpeed) * Math.random();\n\t\tvelocity.copy(position).setLength(length);\n\t}).onUpdate(function(particle, deltaTime){\n\t\tvar position = particle.position.vector;\n\t\tvar velocity = particle.velocity.vector;\n\t\tposition.x += velocity.x * deltaTime;\n\t\tposition.y += velocity.y * deltaTime;\n\t\tposition.z += velocity.z * deltaTime;\n\t}).pushTo(this._emitter);\n\n\treturn this; // for chained API\n};\n/**\n * Shortcut to create Fireworks.EffectRandomDriftVelocity\n*/\nFireworks.EffectsStackBuilder.prototype.randomVelocityDrift\t= function(drift)\n{\n\t// create the effect itself\n\tFireworks.createEffect('randomVelocityDrift', {\n\t\tdrift\t: drift\n\t}).onUpdate(function(particle, deltaTime){\n\t\tvar velocity\t= particle.velocity.vector;\n\t\tvelocity.x\t+= (Math.random()*2 - 1) * this.opts.drift.x * deltaTime;\n\t\tvelocity.y\t+= (Math.random()*2 - 1) * this.opts.drift.y * deltaTime;\n\t\tvelocity.z\t+= (Math.random()*2 - 1) * this.opts.drift.z * deltaTime;\n\t}).pushTo(this._emitter);\n\t// return for chained API\n\treturn this;\t// for chained API\n};\n/**\n * Create a velocity effect\n * @param {Fireworks.Shape}\tshape\tset the direction of the velocity by a randompoint in this shape\n * @param {Number?}\t\tspeed\tset the speed itself. if undefined, keep randompoint length for speed\n*/\nFireworks.EffectsStackBuilder.prototype.velocity\t= function(shape, speed)\n{\n\tFireworks.createEffect('velocity', {\n\t\tshape\t: shape, \n\t\tspeed\t: speed !== undefined ? speed : -1\n\t}).onCreate(function(particle){\n\t\tparticle.velocity = {\n\t\t\tvector\t: new Fireworks.Vector()\n\t\t};\n\t}).onBirth(function(particle){\n\t\tvar velocity\t= particle.velocity.vector;\n\t\tthis.opts.shape.randomPoint(velocity)\n\t\tif( this.opts.speed !== -1 )\tvelocity.setLength(this.opts.speed);\n\t}).onUpdate(function(particle, deltaTime){\n\t\tvar position\t= particle.position.vector;\n\t\tvar velocity\t= particle.velocity.vector;\n\t\tposition.x\t+= velocity.x * deltaTime;\n\t\tposition.y\t+= velocity.y * deltaTime;\n\t\tposition.z\t+= velocity.z * deltaTime;\n\t}).pushTo(this._emitter);\n\n\treturn this;\t// for chained API\n};\n/**\n * Shortcut to create Fireworks.Shape.Box\n*/\nFireworks.createShapeBox\t= function(positionX, positionY, positionZ, sizeX, sizeY, sizeZ){\n\tvar position\t= new Fireworks.Vector(positionX, positionY, positionZ);\n\tvar size\t= new Fireworks.Vector(sizeX, sizeY, sizeZ);\n\treturn new Fireworks.Shape.Box(position, size);\n};\n\n/**\n * Handle a Firework.Shape forming a sphere\n *\n * @param {Fireworks.Vector} position the position of the sphape\n * @param {Fireworks.Vector} shape the size of the shape\n*/\nFireworks.Shape.Box\t= function(position, size)\n{\n\tthis.position\t= position;\n\tthis.size\t= size;\n\tthis._vector\t= new Fireworks.Vector();\n}\n\n// inherit from Fireworks.Effect\nFireworks.Shape.Box.prototype = new Fireworks.Shape();\nFireworks.Shape.Box.prototype.constructor = Fireworks.Shape.Box;\n\nFireworks.Shape.Box.prototype.contains\t= function(point){\n\t// compute delta between the point and the position\n\tvar delta\t= this._vector.sub(point, this.position);\n\t// test the delta is too far\n\tif( Math.abs(delta.x) > this.size.x/2 )\treturn false;\n\tif( Math.abs(delta.y) > this.size.y/2 )\treturn false;\n\tif( Math.abs(delta.z) > this.size.z/2 )\treturn false;\n\t// if all tests, passed true\n\treturn true;\n}\n\nFireworks.Shape.Box.prototype.randomPoint\t= function(vector){\n\tvar point\t= vector\t|| this._vector;\n\t// get a random point\n\tpoint.x\t= Math.random() * this.size.x - this.size.x/2;\n\tpoint.y\t= Math.random() * this.size.y - this.size.y/2;\n\tpoint.z\t= Math.random() * this.size.z - this.size.z/2;\n\t// add this.position\n\tpoint.addSelf(this.position);\n\t// return the point\n\treturn point;\n}\n/**\n * Shortcut to create Fireworks.Shape.Point\n*/\nFireworks.createShapePoint\t= function(positionX, positionY, positionZ){\n\tvar position\t= new Fireworks.Vector(positionX, positionY, positionZ);\n\treturn new Fireworks.Shape.Point(position);\n};\n\n/**\n * Handle a Firework.Shape forming a point\n *\n * @param {Fireworks.Vector} position the position of the point\n*/\nFireworks.Shape.Point\t= function(position)\n{\n\tthis.position\t= position;\n\tthis._vector\t= new Fireworks.Vector();\n}\n\n// inherit from Fireworks.Effect\nFireworks.Shape.Point.prototype = new Fireworks.Shape();\nFireworks.Shape.Point.prototype.constructor = Fireworks.Shape.Point;\n\nFireworks.Shape.Point.prototype.contains\t= function(point){\n\tif( point.x !== this.position.x )\treturn false;\n\tif( point.y !== this.position.y )\treturn false;\n\tif( point.z !== this.position.z )\treturn false;\n\t// if all tests, passed true\n\treturn true;\n}\n\nFireworks.Shape.Point.prototype.randomPoint\t= function(vector){\n\tvar point\t= vector\t|| this._vector;\n\t// get a random point\n\tpoint.copy(this.position);\n\t// return the point\n\treturn point;\n}\n/**\n * Shortcut to create Fireworks.Shape.Box\n*/\nFireworks.createShapeSphere\t= function(positionX, positionY, positionZ, radius, boundingbox){\n\tvar position\t= new Fireworks.Vector(positionX, positionY, positionZ);\n\treturn new Fireworks.ShapeSphere(position, radius);\n};\n\n\n/**\n * Handle a Firework.Shape forming a sphere\n *\n * @param {Fireworks.Vector} position the position of the sphere\n * @param {Number} radius the radius of the sphere\n*/\nFireworks.ShapeSphere\t= function(position, radius)\n{\n\tthis.position\t= position;\n\tthis.radius\t= radius;\n\tthis._vector\t= new Fireworks.Vector();\n}\n\n// inherit from Fireworks.Effect\nFireworks.ShapeSphere.prototype = new Fireworks.Shape();\nFireworks.ShapeSphere.prototype.constructor = Fireworks.ShapeSphere;\n\nFireworks.ShapeSphere.prototype.contains\t= function(point){\n\t// compute distance between the point and the position\n\tvar distance\t= this._vector.sub(point, this.position).length();\n\t// return true if this distance is <= than sphere radius\n\treturn distance <= this.radius;\n}\n\nFireworks.ShapeSphere.prototype.randomPoint\t= function(vector){\n\tvar point\t= vector\t|| this._vector;\n\t// get a random point\n\tpoint.x\t= Math.random()-0.5;\n\tpoint.y\t= Math.random()-0.5;\n\tpoint.z\t= Math.random()-0.5;\n\t// compute the length between the point \n\tvar length\t= Math.random()*this.radius;\n\t// set the point at the proper distance;\n\tpoint.setLength( length );\n\t// add the position\n\tpoint.addSelf(this.position);\n\t// return the point\n\treturn point;\n}\n/**\n * Spawner deliverying paricles in one shot\n * \n * @param {Number?} the number of particle to emit\n*/\nFireworks.EffectsStackBuilder.prototype.spawnerOneShot\t= function(nParticles)\n{\n\t// handle parameter polymorphism\n\tnParticles\t= nParticles\t|| this.emitter().nParticles();\n\t// define local variables\n\tvar emitter\t= this.emitter();\n\tvar nSent\t= 0;\n\tvar spawning\t= true;\n\n\t// create the effect itself\n\tFireworks.createEffect('spawner', {\n\t\treset\t: function(){ nSent\t= 0;\t},\n\t\tstart\t: function(){ spawning\t= true;\t},\n\t\tstop\t: function(){ spawning\t= false;}\n\t}).onPreUpdate(function(deltaTime){\n\t\t// if spawning is false, do nothing\n\t\tif( spawning === false )\treturn;\n\t\t// if already completed, do nothing\n\t\tif( nParticles === nSent )\treturn;\n\t\t// spawn each particle\n\t\tvar amount\t= nParticles - nSent;\n\t\tamount\t\t= Math.min(amount, emitter.deadParticles().length);\n\t\tfor(var i = 0; i < amount; i++){\n\t\t\temitter.spawnParticle();\n\t\t}\n\t\t// update the amount of sent particles\n\t\tnSent\t+= amount;\n\t}).pushTo(this._emitter);\n\t// return this for chained API\n\treturn this;\n};\n/**\n * Spawner deliverying paricles at a steady rate\n * \n * @param {Number?} rate the rate at which it gonna emit\n*/\nFireworks.EffectsStackBuilder.prototype.spawnerSteadyRate\t= function(rate)\n{\n\t// handle parameter polymorphism\n\trate\t= rate !== undefined ? rate\t: 1;\n\t// define local variables\n\tvar emitter\t= this.emitter();\n\tvar nToCreate\t= 1;\n\tvar spawning\t= true;\n\t\n\t// create the effect itself\n\tFireworks.createEffect('spawner', {\n\t\trate\t: rate,\n\t\tstart\t: function(){ spawning = true;\t},\n\t\tstop\t: function(){ spawning = false;\t}\n\t}).onPreUpdate(function(deltaTime){\n\t\tvar rate\t= this.opts.rate;\n\t\t// if spawning is false, do nothing\n\t\tif( spawning === false )\treturn;\n\t\t// update nToCreate\n\t\tnToCreate\t+= rate * deltaTime;\n\t\t// nParticles is the interger part of nToCreate as you spawn them one by one\n\t\tvar nParticles\t= Math.floor(nToCreate);\n\t\t// dont spawn more particles than available\n\t\t// TODO here estimate how much more is needed to never lack of it\n\t\tnParticles\t= Math.min(nParticles, emitter.deadParticles().length);\n\t\t// update nToCreate\n\t\tnToCreate\t-= nParticles;\n\t\t// spawn each particle\n\t\tfor(var i = 0; i < nParticles; i++){\n\t\t\temitter.spawnParticle();\n\t\t}\n\t}).pushTo(this._emitter);\n\t// return this for chained API\n\treturn this;\n};\n/**\n * render to canvas\n*/\nFireworks.EffectsStackBuilder.prototype.renderToCanvas\t= function(opts)\n{\n\topts\t= opts\t\t|| {};\n\tvar ctx\t= opts.ctx\t|| buildDefaultContext();\n\t// create the effect itself\n\tvar effect\t= Fireworks.createEffect('renderToCanvas', {\n\t\tctx\t: ctx\n\t}).pushTo(this._emitter);\n\n\n\tif( opts.type === 'arc' )\t\tctorTypeArc(effect);\n\telse if( opts.type === 'drawImage' )\tctorTypeDrawImage(effect);\n\telse{\n\t\tconsole.assert(false, 'renderToCanvas opts.type is invalid: ');\n\t}\n\n\treturn this;\t// for chained API\n\t\n\n\tfunction buildDefaultContext(){\n\t\t// build canvas element\n\t\tvar canvas\t= document.createElement('canvas');\n\t\tcanvas.width\t= window.innerWidth;\n\t\tcanvas.height\t= window.innerHeight;\n\t\tdocument.body.appendChild(canvas);\n\t\t// canvas.style\n\t\tcanvas.style.position\t= \"absolute\";\n\t\tcanvas.style.left\t= 0;\n\t\tcanvas.style.top\t= 0;\n\t\t// setup ctx\n\t\tvar ctx\t\t= canvas.getContext('2d');\n\t\t// return ctx\n\t\treturn ctx;\n\t}\n\n\tfunction ctorTypeArc(){\n\t\treturn effect.onCreate(function(particle, particleIdx){\n\t\t\tparticle.renderToCanvas = {\n\t\t\t\tsize\t: 3\n\t\t\t};\n\t\t}).onRender(function(particle){\n\t\t\tvar position\t= particle.position.vector;\n\t\t\tvar size\t= particle.renderToCanvas.size;\n\n\t\t\tctx.beginPath();\n\t\t\tctx.arc(position.x + canvas.width /2, \n\t\t\t\tposition.y + canvas.height/2, size, 0, Math.PI*2, true); \n\t\t\tctx.fill();\t\t\t\t\t\n\t\t});\n\t};\n\tfunction ctorTypeDrawImage(){\n\t\t// handle parameter polymorphism\n\t\tif( typeof(opts.image) === 'string' ){\n\t\t\tvar images\t= [new Image];\n\t\t\timages[0].src\t= opts.image;\n\t\t}else if( opts.image instanceof Image ){\n\t\t\tvar images\t= [opts.image];\n\t\t}else if( opts.image instanceof Array ){\n\t\t\tvar images\t= opts.image;\n\t\t}else\tconsole.assert(false, 'invalid .renderToCanvas() options')\n\n\t\treturn effect.onCreate(function(particle, particleIdx){\n\t\t\tparticle.renderToCanvas = {\n\t\t\t\tscale\t\t: 1,\t// should that be there ? or in its own effect ?\n\t\t\t\topacity\t\t: 1,\t// should that be there ? or in its own effect ?\n\t\t\t\trotation\t: 0*Math.PI\n\t\t\t};\n\t\t}).onRender(function(particle){\n\t\t\tvar position\t= particle.position.vector;\n\t\t\tvar data\t= particle.renderToCanvas;\n\t\t\tvar canonAge\t= particle.lifeTime.normalizedAge();\n\t\t\tvar imageIdx\t= Math.floor(canonAge * images.length);\n\t\t\tvar image\t= images[imageIdx];\n\t\t\t// save the context\n\t\t\tctx.save();\n\t\t\t// translate in canvas's center, and the particle position\n\t\t\tctx.translate(position.x + canvas.width/2, position.y + canvas.height/2);\n\t\t\t// set the scale of this particles\n\t\t\tctx.scale(data.scale, data.scale);\n\t\t\t// set the rotation\n\t\t\tctx.rotate(data.rotation);\n\t\t\t// set ctx.globalAlpha\n\t\t\tctx.globalAlpha\t= data.opacity; \n\t\t\t// draw the image itself\n\t\t\tif( image instanceof Image ){\n\t\t\t\tctx.drawImage(image, -image.width/2, -image.height/2);\t\t\t\n\t\t\t}else if( typeof(image) === 'object' ){\n\t\t\t\tctx.drawImage(image.image\n\t\t\t\t \t,  image.offsetX,  image.offsetY , image.width, image.height\n\t\t\t\t\t, -image.width/2, -image.height/2, image.width, image.height);\n\t\t\t}else\tconsole.assert(false);\n\t\t\t// restore the context\n\t\t\tctx.restore();\n\t\t});\n\t};\n};\n/**\n * render to three.js THREE.Object3D\n * If i play with object3D.visible true/false instead of Object3D.add/remove\n * i got a lot of artefacts\n*/\nFireworks.EffectsStackBuilder.prototype.renderToThreejsObject3D\t= function(opts)\n{\n\tvar effectId\t= opts.effectId\t|| 'renderToThreeParticleSystem';\n\tvar container\t= opts.container;\n\n\n\t// create the effect itself\n\tFireworks.createEffect(effectId)\n\t.onCreate(function(particle, particleIdx){\n\t\tparticle.threejsObject3D = {\n\t\t\tobject3d\t: opts.create()\n\t\t};\n\t\tFireworks.debug && console.assert(particle.threejsObject3D.object3d instanceof THREE.Object3D);\n\t\t\n\t\tvar object3d\t= particle.threejsObject3D.object3d;\n\n//\t\tobject3d.visible= false;\n\t}).onBirth(function(particle){\n\t\tvar object3d\t= particle.threejsObject3D.object3d;\n//\t\tobject3d.visible= true;\n\t\tcontainer.add(object3d);\n\t}).onDeath(function(particle){\n\t\tvar object3d\t= particle.threejsObject3D.object3d;\n//\t\tobject3d.visible= false;\n\t\tcontainer.remove(object3d);\n\t}).onRender(function(particle){\n\t\tvar object3d\t= particle.threejsObject3D.object3d;\n\t\tvar position\t= particle.position.vector;\n\t\tobject3d.position.set(position.x, position.y, position.z);\n\t}).pushTo(this._emitter);\n\treturn this;\t// for chained API\n};\n/**\n * render to three.js to THREE.ParticleSystem\n*/\nFireworks.EffectsStackBuilder.prototype.renderToThreejsParticleSystem\t= function(opts)\n{\n\topts\t\t\t= opts\t\t\t|| {};\n\tvar effectId\t\t= opts.effectId\t\t|| 'renderToThreejsParticleSystem';\n\tvar particleSystem\t= opts.particleSystem\t|| defaultParticleSystem;\n\t// if opts.particleSystem is a function, call it to create the particleSystem\n\tif( typeof(particleSystem) === 'function' )\tparticleSystem\t= particleSystem(this._emitter);\n\t// sanity check\n\tconsole.assert(particleSystem instanceof THREE.ParticleSystem, \"particleSystem MUST be THREE.ParticleSystem\");\n\t// some aliases\n\tvar geometry\t= particleSystem.geometry;\n\tconsole.assert(geometry.vertices.length >= this._emitter.nParticles())\n\t// create the effect itself\n\tFireworks.createEffect(effectId, {\n\t\tparticleSystem\t: particleSystem\n\t}).onCreate(function(particle, particleIdx){\n\t\tparticle.threejsParticle = {\n\t\t\tparticleIdx\t: particleIdx\n\t\t};\n\t\tvar vertex\t= geometry.vertices[particleIdx];\n\t\tvertex.set(Infinity, Infinity, Infinity);\n\t}).onDeath(function(particle){\n\t\tvar particleIdx\t= particle.threejsParticle.particleIdx;\n\t\tvar vertex\t= geometry.vertices[particleIdx];\n\t\tvertex.set(Infinity, Infinity, Infinity);\n\t}).onRender(function(particle){\n\t\tvar particleIdx\t= particle.threejsParticle.particleIdx;\n\t\tvar vertex\t= geometry.vertices[particleIdx];\n\t\tvar position\t= particle.position.vector;\n\t\tvertex.set(position.x, position.y, position.z);\n\t}).pushTo(this._emitter);\n\treturn this;\t// for chained API\n\n\t//////////////////////////////////////////////////////////////////////////\n\t//\t\tInternal Functions\t\t\t\t\t//\n\t//////////////////////////////////////////////////////////////////////////\n\n\tfunction defaultParticleSystem(emitter){\n\t\tvar geometry\t= new THREE.Geometry();\n\t\tfor( var i = 0; i < emitter.nParticles(); i++ ){\n\t\t\tgeometry.vertices.push( new THREE.Vector3() );\n\t\t}\n\t\tvar material\t= new THREE.ParticleBasicMaterial({\n\t\t\tsize\t\t: 5,\n\t\t\tsizeAttenuation\t: true,\n\t\t\tcolor\t\t: 0xE01B6A,\n\t\t\tmap\t\t: generateTexture(),\n\t\t\tblending\t: THREE.AdditiveBlending,\n\t\t\tdepthWrite\t: false,\n\t\t\ttransparent\t: true\n\t\t});\n\t\tvar particleSystem\t\t= new THREE.ParticleSystem(geometry, material);\n\t\tparticleSystem.dynamic\t\t= true;\n\t\tparticleSystem.sortParticles\t= true;\n\t\treturn particleSystem;\n\t}\n\n\tfunction generateTexture(size){\n\t\tsize\t\t= size || 128;\n\t\tvar canvas\t= document.createElement( 'canvas' );\n\t\tvar context\t= canvas.getContext( '2d' );\n\t\tcanvas.width\t= canvas.height\t= size;\n\n\t\tvar gradient\t= context.createRadialGradient( canvas.width/2, canvas.height /2, 0, canvas.width /2, canvas.height /2, canvas.width /2 );\t\t\n\t\tgradient.addColorStop( 0  , 'rgba(255,255,255,1)' );\n\t\tgradient.addColorStop( 0.5, 'rgba(255,255,255,1)' );\n\t\tgradient.addColorStop( 0.7, 'rgba(128,128,128,1)' );\n\t\tgradient.addColorStop( 1  , 'rgba(0,0,0,1)' );\n\n\t\tcontext.beginPath();\n\t\tcontext.arc(size/2, size/2, size/2, 0, Math.PI*2, false);\n\t\tcontext.closePath();\n\n\t\tcontext.fillStyle\t= gradient;\n\t\t//context.fillStyle\t= 'rgba(128,128,128,1)';\n\t\tcontext.fill();\n\n\t\tvar texture\t= new THREE.Texture( canvas );\n\t\ttexture.needsUpdate = true;\n\n\t\treturn texture;\n\t}\n};\n\nFireworks.Emitter.prototype.bindTriggerDomEvents\t= function(domElement){\n\tvar tmp\t= new Fireworks.BindTriggerDomEvents(this, domElement);\n\treturn this;\t// for chained API\n}\n\nFireworks.BindTriggerDomEvents\t= function(emitter, domElement){\n\tthis._domElement= domElement\t|| document.body;\n\n\t// bind mouse event\n\tthis._onMouseDown\t= function(){ emitter.effect('spawner').opts.start();\t};\n\tthis._onMouseUp\t\t= function(){ emitter.effect('spawner').opts.stop();\t};\n\tthis._domElement.addEventListener('mousedown'\t, this._onMouseDown\t);\n\tthis._domElement.addEventListener('mouseup'\t, this._onMouseUp\t);\n\n\t// change emitter intensity on mousewheel\t\t\n\tthis._onMouseWheel\t= function(event){\n\t\tvar intensity\t= emitter.intensity();\n\t\tintensity\t+= event.wheelDelta < 0 ? -0.05 : 0.05;\n\t\tintensity\t= Math.max(intensity, 0);\n\t\tintensity\t= Math.min(intensity, 1);\n\t\temitter.intensity(intensity);\n\t};\n\tthis._domElement.addEventListener('mousewheel'\t, this._onMouseWheel\t);\n}\n\n\nFireworks.BindTriggerDomEvents.prototype.destroy\t= function(){\n\tthis._domElement.removeEventListener('mousedown'\t, this._onMouseDown\t);\n\tthis._domElement.removeEventListener('mouseup'\t\t, this._onMouseUp\t);\n\tthis._domElement.removeEventListener('mousewheel'\t, this._onMouseWheel\t);\n};\nFireworks.DatGui4Emitter\t= function(emitter){\n\tvar gui\t\t= new dat.GUI();\n\tvar effects\t= emitter.effects();\n\teffects.forEach(function(effect, idx){\n\t\tvar effectName\t= effect.name\t|| \"effect-\"+idx;\n\t\tvar opts\t= effect.opts\t|| {};\n\t\tvar keys\t= Object.keys(opts).filter(function(key){\n\t\t\tif( opts[key] instanceof Fireworks.Vector )\treturn true;\n\t\t\tif( typeof(opts[key]) === 'object' )\t\treturn false;\n\t\t\treturn true;\n\t\t});\n\t\tif( keys.length ){\n\t\t\tvar folder\t= gui.addFolder('Effect: '+effectName);\n\t\t\tkeys.forEach(function(key){\n\t\t\t\tif( opts[key] instanceof Fireworks.Vector ){\n\t\t\t\t\tfolder.add(opts[key], 'x').name(key+\"X\");\n\t\t\t\t\tfolder.add(opts[key], 'y').name(key+\"Y\");\n\t\t\t\t\tfolder.add(opts[key], 'z').name(key+\"Z\");\n\t\t\t\t}else{\n\t\t\t\t\tfolder.add(opts, key);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\t// return the built gui\n\treturn gui;\n};Fireworks.ProceduralTextures\t= {};\n\nFireworks.ProceduralTextures.buildTexture\t= function(size)\n{\n\tsize\t\t= size || 150;\n\tvar canvas\t= document.createElement( 'canvas' );\n\tvar context\t= canvas.getContext( '2d' );\n\tcanvas.width\t= canvas.height\t= size;\n\n\tvar gradient\t= context.createRadialGradient( canvas.width/2, canvas.height /2, 0, canvas.width /2, canvas.height /2, canvas.width /2 );\t\t\n\tgradient.addColorStop( 0  , 'rgba(255,255,255,1)' );\n\tgradient.addColorStop( 0.5, 'rgba(255,255,255,1)' );\n\tgradient.addColorStop( 0.7, 'rgba(128,128,128,1)' );\n\tgradient.addColorStop( 1  , 'rgba(0,0,0,1)' );\n\n\tcontext.beginPath();\n\tcontext.arc(size/2, size/2, size/2, 0, Math.PI*2, false);\n\tcontext.closePath();\n\n\tcontext.fillStyle\t= gradient;\n\t//context.fillStyle\t= 'rgba(128,128,128,1)';\n\tcontext.fill();\n\n\tvar texture\t= new THREE.Texture( canvas );\n\ttexture.needsUpdate = true;\n\n\treturn texture;\n}\n\n\n/**\n * @author alteredq / http://alteredqualia.com/\n * @author mr.doob / http://mrdoob.com/\n */\n\nvar Detector = {\n\n\tcanvas: !! window.CanvasRenderingContext2D,\n\twebgl: ( function () { try { return !! window.WebGLRenderingContext && !! document.createElement( 'canvas' ).getContext( 'experimental-webgl' ); } catch( e ) { return false; } } )(),\n\tworkers: !! window.Worker,\n\tfileapi: window.File && window.FileReader && window.FileList && window.Blob,\n\n\tgetWebGLErrorMessage: function () {\n\n\t\tvar element = document.createElement( 'div' );\n\t\telement.id = 'webgl-error-message';\n\t\telement.style.fontFamily = 'monospace';\n\t\telement.style.fontSize = '13px';\n\t\telement.style.fontWeight = 'normal';\n\t\telement.style.textAlign = 'center';\n\t\telement.style.background = '#fff';\n\t\telement.style.color = '#000';\n\t\telement.style.padding = '1.5em';\n\t\telement.style.width = '400px';\n\t\telement.style.margin = '5em auto 0';\n\n\t\tif ( ! this.webgl ) {\n\n\t\t\telement.innerHTML = window.WebGLRenderingContext ? [\n\t\t\t\t'Your graphics card does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\" style=\"color:#000\">WebGL</a>.<br />',\n\t\t\t\t'Find out how to get it <a href=\"http://get.webgl.org/\" style=\"color:#000\">here</a>.'\n\t\t\t].join( '\\n' ) : [\n\t\t\t\t'Your browser does not seem to support <a href=\"http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\" style=\"color:#000\">WebGL</a>.<br/>',\n\t\t\t\t'Find out how to get it <a href=\"http://get.webgl.org/\" style=\"color:#000\">here</a>.'\n\t\t\t].join( '\\n' );\n\n\t\t}\n\n\t\treturn element;\n\n\t},\n\n\taddGetWebGLMessage: function ( parameters ) {\n\n\t\tvar parent, id, element;\n\n\t\tparameters = parameters || {};\n\n\t\tparent = parameters.parent !== undefined ? parameters.parent : document.body;\n\t\tid = parameters.id !== undefined ? parameters.id : 'oldie';\n\n\t\telement = Detector.getWebGLErrorMessage();\n\t\telement.id = id;\n\n\t\tparent.appendChild( element );\n\n\t}\n\n};\n\n// This THREEx helper makes it easy to handle window resize.\n// It will update renderer and camera when window is resized.\n//\n// # Usage\n//\n// **Step 1**: Start updating renderer and camera\n//\n// ```var windowResize = new THREEx.WindowResize(aRenderer, aCamera)```\n//    \n// **Step 2**: stop updating renderer and camera\n//\n// ```windowResize.destroy()```\n// # Code\n\n//\n\n/** @namespace */\nvar THREEx\t= THREEx || {}\n\n/**\n * Update renderer and camera when the window is resized\n * \n * @param {Object} renderer the renderer to update\n * @param {Object} Camera the camera to update\n*/\nTHREEx.WindowResize\t= function(renderer, camera){\n\tvar callback\t= function(){\n\t\t// notify the renderer of the size change\n\t\trenderer.setSize( window.innerWidth, window.innerHeight )\n\t\t// update the camera\n\t\tcamera.aspect\t= window.innerWidth / window.innerHeight\n\t\tcamera.updateProjectionMatrix()\n\t}\n\t// bind the resize event\n\twindow.addEventListener('resize', callback, false)\n\t// return .stop() the function to stop watching window resize\n\treturn {\n\t\ttrigger\t: function(){\n\t\t\tcallback()\n\t\t},\n\t\t/**\n\t\t * Stop watching window resize\n\t\t*/\n\t\tdestroy\t: function(){\n\t\t\twindow.removeEventListener('resize', callback)\n\t\t}\n\t}\n}\n\n// stats.js - http://github.com/mrdoob/stats.js\nvar Stats=function(){var l=Date.now(),m=l,g=0,n=Infinity,o=0,h=0,p=Infinity,q=0,r=0,s=0,f=document.createElement(\"div\");f.id=\"stats\";f.addEventListener(\"mousedown\",function(b){b.preventDefault();t(++s%2)},!1);f.style.cssText=\"width:80px;opacity:0.9;cursor:pointer\";var a=document.createElement(\"div\");a.id=\"fps\";a.style.cssText=\"padding:0 0 3px 3px;text-align:left;background-color:#002\";f.appendChild(a);var i=document.createElement(\"div\");i.id=\"fpsText\";i.style.cssText=\"color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px\";\ni.innerHTML=\"FPS\";a.appendChild(i);var c=document.createElement(\"div\");c.id=\"fpsGraph\";c.style.cssText=\"position:relative;width:74px;height:30px;background-color:#0ff\";for(a.appendChild(c);74>c.children.length;){var j=document.createElement(\"span\");j.style.cssText=\"width:1px;height:30px;float:left;background-color:#113\";c.appendChild(j)}var d=document.createElement(\"div\");d.id=\"ms\";d.style.cssText=\"padding:0 0 3px 3px;text-align:left;background-color:#020;display:none\";f.appendChild(d);var k=document.createElement(\"div\");\nk.id=\"msText\";k.style.cssText=\"color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px\";k.innerHTML=\"MS\";d.appendChild(k);var e=document.createElement(\"div\");e.id=\"msGraph\";e.style.cssText=\"position:relative;width:74px;height:30px;background-color:#0f0\";for(d.appendChild(e);74>e.children.length;)j=document.createElement(\"span\"),j.style.cssText=\"width:1px;height:30px;float:left;background-color:#131\",e.appendChild(j);var t=function(b){s=b;switch(s){case 0:a.style.display=\n\"block\";d.style.display=\"none\";break;case 1:a.style.display=\"none\",d.style.display=\"block\"}};return{REVISION:11,domElement:f,setMode:t,begin:function(){l=Date.now()},end:function(){var b=Date.now();g=b-l;n=Math.min(n,g);o=Math.max(o,g);k.textContent=g+\" MS (\"+n+\"-\"+o+\")\";var a=Math.min(30,30-30*(g/200));e.appendChild(e.firstChild).style.height=a+\"px\";r++;b>m+1E3&&(h=Math.round(1E3*r/(b-m)),p=Math.min(p,h),q=Math.max(q,h),i.textContent=h+\" FPS (\"+p+\"-\"+q+\")\",a=Math.min(30,30-30*(h/100)),c.appendChild(c.firstChild).style.height=\na+\"px\",m=b,r=0);return b},update:function(){l=this.end()}}};\n\n\n/**\n * Tutorials:\n * http://www.html5rocks.com/en/tutorials/webaudio/games/\n * http://www.html5rocks.com/en/tutorials/webaudio/positional_audio/ <- +1 as it is three.js\n * http://www.html5rocks.com/en/tutorials/webaudio/intro/\n *\n * Spec:\n * https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html\n *\n * Chromium Demo:\n * http://chromium.googlecode.com/svn/trunk/samples/audio/index.html  <- running page\n * http://code.google.com/p/chromium/source/browse/trunk/samples/audio/ <- source\n*/\n\n\n/**\n * Notes on removing tQuery dependancy\n * * some stuff depends on tQuery\n * * find which one\n * * tQuery.Webaudio got a world link for the listener\n *   * do a plugin with followListener(world), unfollowListener(world)\n * * namespace become WebAudio.* instead of WebAudio.*\n*/\n\n//////////////////////////////////////////////////////////////////////////////////\n//////////////////////////////////////////////////////////////////////////////////\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tWebAudio\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n//////////////////////////////////////////////////////////////////////////////////\n//////////////////////////////////////////////////////////////////////////////////\n\n\nwindow.AudioContext\t= window.AudioContext || window.webkitAudioContext;\n\n/**\n * Main class to handle webkit audio\n * \n * TODO make the clip detector from http://www.html5rocks.com/en/tutorials/webaudio/games/\n *\n * @class Handle webkit audio API\n *\n * @param {tQuery.World} [world] the world on which to run \n*/\nWebAudio\t= function(){\n\t// sanity check - the api MUST be available\n\tif( WebAudio.isAvailable === false ){\n\t\tthis._addRequiredMessage();\n\t\t// Throw an error to stop execution\n\t\tthrow new Error('WebAudio API is required and not available.')\t\n\t}\n\t\n\t// create the context\n\tthis._ctx\t= new AudioContext();\n\t// setup internal variable\n\tthis._muted\t= false;\n\tthis._volume\t= 1;\n\n\t// setup the end of the node chain\n\t// TODO later code the clipping detection from http://www.html5rocks.com/en/tutorials/webaudio/games/ \n\tthis._gainNode\t= this._ctx.createGain();\n\tthis._compressor= this._ctx.createDynamicsCompressor();\n\tthis._gainNode.connect( this._compressor );\n\tthis._compressor.connect( this._ctx.destination );\t\n\n\t// init page visibility\n\tthis._pageVisibilityCtor();\t\n};\n\n\n/**\n * vendor.js way to make plugins ala jQuery\n * @namespace\n*/\nWebAudio.fn\t= WebAudio.prototype;\n\n\n/**\n * destructor\n*/\nWebAudio.prototype.destroy\t= function(){\n\tthis._pageVisibilityDtor();\n};\n\n/**\n * @return {Boolean} true if it is available or not\n*/\nWebAudio.isAvailable\t= window.AudioContext ? true : false;\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tcomment\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\nWebAudio.prototype._addRequiredMessage = function(parent) {\n\t// handle defaults arguements\n\tparent\t= parent || document.body;\n\t// message directly taken from Detector.js\n\tvar domElement = document.createElement( 'div' );\n\tdomElement.style.fontFamily\t= 'monospace';\n\tdomElement.style.fontSize\t= '13px';\n\tdomElement.style.textAlign\t= 'center';\n\tdomElement.style.background\t= '#eee';\n\tdomElement.style.color\t\t= '#000';\n\tdomElement.style.padding\t= '1em';\n\tdomElement.style.width\t\t= '475px';\n\tdomElement.style.margin\t\t= '5em auto 0';\n\tdomElement.innerHTML\t\t= [\n\t\t'Your browser does not seem to support <a href=\"https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html\">WebAudio API</a>.<br />',\n\t\t'Try with <a href=\"https://www.google.com/intl/en/chrome/browser/\">Chrome Browser</a>.'\n\t].join( '\\n' );\n\t// add it to the parent\n\tparent.appendChild(domElement);\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\t\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * get the audio context\n *\n * @returns {AudioContext} the audio context\n*/\nWebAudio.prototype.context\t= function(){\n\treturn this._ctx;\n};\n\n/**\n * Create a sound\n *\n * @returns {WebAudio.Sound} the sound just created\n*/\nWebAudio.prototype.createSound\t= function()\n{\n\tvar webaudio\t= this;\n\tvar sound\t= new WebAudio.Sound(webaudio);\n\treturn sound;\n}\n\n\n/**\n * return the entry node in the master node chains\n*/\nWebAudio.prototype._entryNode\t= function(){\n\t//return this._ctx.destination;\n\treturn this._gainNode;\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tvolume/mute\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * getter/setter on the volume\n*/\nWebAudio.prototype.volume\t= function(value){\n\tif( value === undefined )\treturn this._volume;\n\t// update volume\n\tthis._volume\t= value;\n\t// update actual volume IIF not muted\n\tif( this._muted  === false ){\n\t\tthis._gainNode.gain.value\t= this._volume;\t\n\t}\n\t// return this for chained API\n\treturn this;\n};\n\n/** \n * getter/setter for mute\n*/\nWebAudio.prototype.mute\t= function(value){\n\tif( value === undefined )\treturn this._muted;\n\tthis._muted\t= value;\n\tthis._gainNode.gain.value\t= this._muted ? 0 : this._volume;\n\treturn this;\t// for chained API\n}\n\n/**\n * to toggle the mute\n*/\nWebAudio.prototype.toggleMute\t= function(){\n\tif( this.mute() )\tthis.mute(false);\n\telse\t\t\tthis.mute(true);\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tpageVisibility\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n\nWebAudio.prototype._pageVisibilityCtor\t= function(){\n\t// shim to handle browser vendor\n\tthis._pageVisibilityEventStr\t= (document.hidden !== undefined\t? 'visibilitychange'\t:\n\t\t(document.mozHidden\t!== undefined\t\t? 'mozvisibilitychange'\t:\n\t\t(document.msHidden\t!== undefined\t\t? 'msvisibilitychange'\t:\n\t\t(document.webkitHidden\t!== undefined\t\t? 'webkitvisibilitychange' :\n\t\tconsole.assert(false, \"Page Visibility API unsupported\")\n\t))));\n\tthis._pageVisibilityDocumentStr\t= (document.hidden !== undefined ? 'hidden' :\n\t\t(document.mozHidden\t!== undefined ? 'mozHidden' :\n\t\t(document.msHidden\t!== undefined ? 'msHidden' :\n\t\t(document.webkitHidden\t!== undefined ? 'webkitHidden' :\n\t\tconsole.assert(false, \"Page Visibility API unsupported\")\n\t))));\n\t// event handler for visibilitychange event\n\tthis._$pageVisibilityCallback\t= function(){\n\t\tvar isHidden\t= document[this._pageVisibilityDocumentStr] ? true : false;\n\t\tthis.mute( isHidden ? true : false );\n\t}.bind(this);\n\t// bind the event itself\n\tdocument.addEventListener(this._pageVisibilityEventStr, this._$pageVisibilityCallback, false);\n}\n\nWebAudio.prototype._pageVisibilityDtor\t= function(){\n\t// unbind the event itself\n\tdocument.removeEventListener(this._pageVisibilityEventStr, this._$pageVisibilityCallback, false);\n}\n/**\n * Constructor\n *\n * @class builder to generate nodes chains. Used in WebAudio.Sound\n * @param {AudioContext} audioContext the audio context\n*/\nWebAudio.NodeChainBuilder\t= function(audioContext){\n\tconsole.assert(audioContext instanceof AudioContext);\n\tthis._context\t= audioContext;\n\tthis._firstNode\t= null;\n\tthis._lastNode\t= null;\n\tthis._nodes\t= {};\n};\n\n/**\n * creator\n * \n * @param  {webkitAudioContext} \taudioContext the context\t\n * @return {WebAudio.NodeChainBuider}\tjust created object\n */\nWebAudio.NodeChainBuilder.create= function(audioContext){\n\treturn new WebAudio.NodeChainBuilder(audioContext);\n}\n\n/**\n * destructor\n*/\nWebAudio.NodeChainBuilder.prototype.destroy\t= function(){\n};\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tgetters\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * getter for the nodes\n*/\nWebAudio.NodeChainBuilder.prototype.nodes\t= function(){\n\treturn this._nodes;\n}\n\n/**\n * @returns the first node of the chain\n*/\nWebAudio.NodeChainBuilder.prototype.first\t= function(){\n\treturn this._firstNode;\n}\n\n/**\n * @returns the last node of the chain\n*/\nWebAudio.NodeChainBuilder.prototype.last\t= function(){\n\treturn this._lastNode;\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\t\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * add a node to the chain\n * @param {[type]} node       [description]\n * @param {[type]} properties [description]\n */\nWebAudio.NodeChainBuilder.prototype._addNode\t= function(node, properties)\n{\n\t// update this._bufferSourceDst - needed for .cloneBufferSource()\n\tvar lastIsBufferSource\t= this._lastNode && ('playbackRate' in this._lastNode) ? true : false;\n\tif( lastIsBufferSource )\tthis._bufferSourceDst\t= node;\n\n\t// connect this._lastNode to node if suitable\n\tif( this._lastNode !== null )\tthis._lastNode.connect(node);\n\t\n\t// update this._firstNode && this._lastNode\n\tif( this._firstNode === null )\tthis._firstNode\t= node;\n\tthis._lastNode\t= node;\n\t\t\n\t// apply properties to the node\n\tfor( var property in properties ){\n\t\tnode[property]\t= properties[property];\n\t}\n\n\t// for chained API\n\treturn this;\n};\n\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tcreator for each type of nodes\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * Clone the bufferSource. Used just before playing a sound\n * @returns {AudioBufferSourceNode} the clone AudioBufferSourceNode\n*/\nWebAudio.NodeChainBuilder.prototype.cloneBufferSource\t= function(){\n\tconsole.assert(this._nodes.bufferSource, \"no buffersource presents. Add one.\");\n\tvar orig\t= this._nodes.bufferSource;\n\tvar clone\t= this._context.createBufferSource()\n\tclone.buffer\t\t= orig.buffer;\n\tclone.playbackRate\t= orig.playbackRate;\n\tclone.loop\t\t= orig.loop;\n\tclone.connect(this._bufferSourceDst);\n\treturn clone;\n}\n\n/**\n * add a bufferSource\n *\n * @param {Object} [properties] properties to set in the created node\n*/\nWebAudio.NodeChainBuilder.prototype.bufferSource\t= function(properties){\n\tvar node\t\t= this._context.createBufferSource()\n\tthis._nodes.bufferSource= node;\n\treturn this._addNode(node, properties)\n};\n\n/**\n * add a createMediaStreamSource\n *\n * @param {Object} [properties] properties to set in the created node\n*/\nWebAudio.NodeChainBuilder.prototype.mediaStreamSource\t= function(stream, properties){\n//\tconsole.assert( stream instanceof LocalMediaStream )\n\tvar node\t\t= this._context.createMediaStreamSource(stream)\n\tthis._nodes.bufferSource= node;\n\treturn this._addNode(node, properties)\n};\n\n/**\n * add a createMediaElementSource\n * @param  {HTMLElement} element    the element to add\n * @param {Object} [properties] properties to set in the created node\n */\nWebAudio.NodeChainBuilder.prototype.mediaElementSource = function(element, properties){\n\tconsole.assert(element instanceof HTMLAudioElement || element instanceof HTMLVideoElement)\n\tvar node\t\t= this._context.createMediaElementSource(element)\n\tthis._nodes.bufferSource= node;\n\treturn this._addNode(node, properties)\n};\n\n/**\n * add a panner\n * \n * @param {Object} [properties] properties to set in the created node\n*/\nWebAudio.NodeChainBuilder.prototype.panner\t= function(properties){\n\tvar node\t\t= this._context.createPanner()\n\tthis._nodes.panner\t= node;\n\treturn this._addNode(node, properties)\n};\n\n/**\n * add a analyser\n *\n * @param {Object} [properties] properties to set in the created node\n*/\nWebAudio.NodeChainBuilder.prototype.analyser\t= function(properties){\n\tvar node\t\t= this._context.createAnalyser()\n\tthis._nodes.analyser\t= node;\n\treturn this._addNode(node, properties)\n};\n\n/**\n * add a gainNode\n *\n * @param {Object} [properties] properties to set in the created node\n*/\nWebAudio.NodeChainBuilder.prototype.gainNode\t= function(properties){\n\tvar node\t\t= this._context.createGain()\n\tthis._nodes.gainNode\t= node;\n\treturn this._addNode(node, properties)\n};\n\n/**\n * sound instance\n *\n * @class Handle one sound for WebAudio\n *\n * @param {tQuery.World} [world] the world on which to run\n * @param {WebAudio.NodeChainBuilder} [nodeChain] the nodeChain to use\n*/\nWebAudio.Sound\t= function(webaudio, nodeChain){\n\tthis._webaudio\t= webaudio;\n\tthis._context\t= this._webaudio.context();\n\n\tconsole.assert( this._webaudio instanceof WebAudio );\n\n\t// create a default NodeChainBuilder if needed\n\tif( nodeChain === undefined ){\n\t\tnodeChain\t= new WebAudio.NodeChainBuilder(this._context)\n\t\t\t\t\t.bufferSource().gainNode().analyser().panner();\n\t}\n\t// setup this._chain\n\tconsole.assert( nodeChain instanceof WebAudio.NodeChainBuilder );\n\tthis._chain\t= nodeChain;\n\t// connect this._chain.last() node to this._webaudio._entryNode()\n\tthis._chain.last().connect( this._webaudio._entryNode() );\n\t\n\t// create some alias\n\tthis._source\t= this._chain.nodes().bufferSource;\n\tthis._gainNode\t= this._chain.nodes().gainNode;\n\tthis._analyser\t= this._chain.nodes().analyser;\n\tthis._panner\t= this._chain.nodes().panner;\n\t\n\t// sanity check\n\tconsole.assert(this._source\t, \"no bufferSource: not yet supported\")\n\tconsole.assert(this._gainNode\t, \"no gainNode: not yet supported\")\n\tconsole.assert(this._analyser\t, \"no analyser: not yet supported\")\n\tconsole.assert(this._panner\t, \"no panner: not yet supported\")\n};\n\nWebAudio.Sound.create\t= function(webaudio, nodeChain){\n\treturn new WebAudio.Sound(webaudio,  nodeChain);\n}\n\n/**\n * destructor\n*/\nWebAudio.Sound.prototype.destroy\t= function(){\n\t// disconnect from this._webaudio\n\tthis._chain.last().disconnect();\n\t// destroy this._chain\n\tthis._chain.destroy();\n\tthis._chain\t= null;\n};\n\n/**\n * vendor.js way to make plugins ala jQuery\n * @namespace\n*/\nWebAudio.Sound.fn\t= WebAudio.Sound.prototype;\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\t\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * getter of the chain nodes\n*/\nWebAudio.Sound.prototype.nodes\t= function(){\n\treturn this._chain.nodes();\n};\n\n/**\n * @returns {Boolean} true if the sound is playable, false otherwise\n*/\nWebAudio.Sound.prototype.isPlayable\t= function(){\n\treturn this._source.buffer ? true : false;\n};\n\n/**\n * play the sound\n *\n * @param {Number} [time] time when to play the sound\n*/\nWebAudio.Sound.prototype.play\t\t= function(time){\n\t// handle parameter polymorphism\n\tif( time ===  undefined )\ttime\t= 0;\n\t// if not yet playable, ignore\n\t// - usefull when the sound download isnt yet completed\n\tif( this.isPlayable() === false )\treturn;\n\t// clone the bufferSource\n\tvar clonedNode\t= this._chain.cloneBufferSource();\n\t// set the noteOn\n\tclonedNode.start(time);\n\t// create the source object\n\tvar source\t= {\n\t\tnode\t: clonedNode,\n\t\tstop\t: function(time){\n\t\t\tif( time ===  undefined )\ttime\t= 0;\n\t\t\tthis.node.stop(time);\n\t\t\treturn source;\t// for chained API\n\t\t}\n\t}\n\t// return it\n\treturn source;\n};\n\n/**\n * getter/setter on the volume\n *\n * @param {Number} [value] the value to set, if not provided, get current value\n*/\nWebAudio.Sound.prototype.volume\t= function(value){\n\tif( value === undefined )\treturn this._gainNode.gain.value;\n\tthis._gainNode.gain.value\t= value;\n\treturn this;\t// for chained API\n};\n\n\n/**\n * getter/setter on the loop\n * \n * @param {Number} [value] the value to set, if not provided, get current value\n*/\nWebAudio.Sound.prototype.loop\t= function(value){\n\tif( value === undefined )\treturn this._source.loop;\n\tthis._source.loop\t= value;\n\treturn this;\t// for chained API\n};\n\n/**\n * getter/setter on the source buffer\n * \n * @param {Number} [value] the value to set, if not provided, get current value\n*/\nWebAudio.Sound.prototype.buffer\t= function(value){\n\tif( value === undefined )\treturn this._source.buffer;\n\tthis._source.buffer\t= value;\n\treturn this;\t// for chained API\n};\n\n\n/**\n * Set parameter for the pannerCone\n *\n * @param {Number} innerAngle the inner cone hangle in radian\n * @param {Number} outerAngle the outer cone hangle in radian\n * @param {Number} outerGain the gain to apply when in the outerCone\n*/\nWebAudio.Sound.prototype.pannerCone\t= function(innerAngle, outerAngle, outerGain)\n{\n\tthis._panner.coneInnerAngle\t= innerAngle * 180 / Math.PI;\n\tthis._panner.coneOuterAngle\t= outerAngle * 180 / Math.PI;\n\tthis._panner.coneOuterGain\t= outerGain;\n\treturn this;\t// for chained API\n};\n\n/**\n * getter/setter on the pannerConeInnerAngle\n * \n * @param {Number} value the angle in radian\n*/\nWebAudio.Sound.prototype.pannerConeInnerAngle\t= function(value){\n\tif( value === undefined )\treturn this._panner.coneInnerAngle / 180 * Math.PI;\n\tthis._panner.coneInnerAngle\t= value * 180 / Math.PI;\n\treturn this;\t// for chained API\n};\n\n/**\n * getter/setter on the pannerConeOuterAngle\n *\n * @param {Number} value the angle in radian\n*/\nWebAudio.Sound.prototype.pannerConeOuterAngle\t= function(value){\n\tif( value === undefined )\treturn this._panner.coneOuterAngle / 180 * Math.PI;\n\tthis._panner.coneOuterAngle\t= value * 180 / Math.PI;\n\treturn this;\t// for chained API\n};\n\n/**\n * getter/setter on the pannerConeOuterGain\n * \n * @param {Number} value the value\n*/\nWebAudio.Sound.prototype.pannerConeOuterGain\t= function(value){\n\tif( value === undefined )\treturn this._panner.coneOuterGain;\n\tthis._panner.coneOuterGain\t= value;\n\treturn this;\t// for chained API\n};\n\n/**\n * compute the amplitude of the sound (not sure at all it is the proper term)\n *\n * @param {Number} width the number of frequencyBin to take into account\n * @returns {Number} return the amplitude of the sound\n*/\nWebAudio.Sound.prototype.amplitude\t= function(width)\n{\n\t// handle paramerter\n\twidth\t\t= width !== undefined ? width : 2;\n\t// inint variable\n\tvar analyser\t= this._analyser;\n\tvar freqByte\t= new Uint8Array(analyser.frequencyBinCount);\n\t// get the frequency data\n\tanalyser.getByteFrequencyData(freqByte);\n\t// compute the sum\n\tvar sum\t= 0;\n\tfor(var i = 0; i < width; i++){\n\t\tsum\t+= freqByte[i];\n\t}\n\t// complute the amplitude\n\tvar amplitude\t= sum / (width*256-1);\n\t// return ampliture\n\treturn amplitude;\n}\n\n/**\n * Generate a sinusoid buffer.\n * FIXME should likely be in a plugin\n*/\nWebAudio.Sound.prototype.tone\t= function(hertz, seconds){\n\t// handle parameter\n\thertz\t= hertz !== undefined ? hertz : 200;\n\tseconds\t= seconds !== undefined ? seconds : 1;\n\t// set default value\t\n\tvar nChannels\t= 1;\n\tvar sampleRate\t= 44100;\n\tvar amplitude\t= 2;\n\t// create the buffer\n\tvar buffer\t= this._webaudio.context().createBuffer(nChannels, seconds*sampleRate, sampleRate);\n\tvar fArray\t= buffer.getChannelData(0);\n\t// fill the buffer\n\tfor(var i = 0; i < fArray.length; i++){\n\t\tvar time\t= i / buffer.sampleRate;\n\t\tvar angle\t= hertz * time * Math.PI;\n\t\tfArray[i]\t= Math.sin(angle)*amplitude;\n\t}\n\t// set the buffer\n\tthis.buffer(buffer);\n\treturn this;\t// for chained API\n}\n\n\n/**\n * Put this function is .Sound with getByt as private callback\n*/\nWebAudio.Sound.prototype.makeHistogram\t= function(nBar)\n{\t\n\t// get analyser node\n\tvar analyser\t= this._analyser;\n\t// allocate the private histo if needed - to avoid allocating at every frame\n\t//this._privHisto\t= this._privHisto || new Float32Array(analyser.frequencyBinCount);\n\tthis._privHisto\t= this._privHisto || new Uint8Array(analyser.frequencyBinCount);\n\t// just an alias\n\tvar freqData\t= this._privHisto;\n\n\t// get the data\n\t//analyser.getFloatFrequencyData(freqData);\n\tanalyser.getByteFrequencyData(freqData);\n\t//analyser.getByteTimeDomainData(freqData);\n\n\t/**\n\t * This should be in imageprocessing.js almost\n\t*/\n\tvar makeHisto\t= function(srcArr, dstLength){\n\t\tvar barW\t= Math.floor(srcArr.length / dstLength);\n\t\tvar nBar\t= Math.floor(srcArr.length / barW);\n\t\tvar arr\t\t= []\n\t\tfor(var x = 0, arrIdx = 0; x < srcArr.length; arrIdx++){\n\t\t\tvar sum\t= 0;\n\t\t\tfor(var i = 0; i < barW; i++, x++){\n\t\t\t\tsum += srcArr[x];\n\t\t\t}\n\t\t\tvar average\t= sum/barW;\n\t\t\tarr[arrIdx]\t= average;\n\t\t}\n\t\treturn arr;\n\t}\n\t// build the histo\n\tvar histo\t= makeHisto(freqData, nBar);\n\t// return it\n\treturn histo;\n}\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\t\t\t\t\t\t\t\t\t//\n//////////////////////////////////////////////////////////////////////////////////\n\n/**\n * Load a sound\n *\n * @param {String} url the url of the sound to load\n * @param {Function} onSuccess function to notify once the url is loaded (optional)\n * @param {Function} onError function to notify if an error occurs (optional)\n*/\nWebAudio.Sound.prototype.load = function(url, onSuccess, onError){\n\t// handle default arguments\n\tonError\t= onError\t|| function(){\n\t\tconsole.warn(\"unable to load sound \"+url);\n\t}\n\t// try to load the user\t\n\tthis._loadAndDecodeSound(url, function(buffer){\n\t\tthis._source.buffer\t= buffer;\n\t\tonSuccess && onSuccess(this);\n\t}.bind(this), function(){\n\t\tonError && onError(this);\n\t}.bind(this));\n\treturn this;\t// for chained API\n};\n\n/**\n * Load and decode a sound\n *\n * @param {String} url the url where to get the sound\n * @param {Function} onLoad the function called when the sound is loaded and decoded (optional)\n * @param {Function} onError the function called when an error occured (optional)\n*/\nWebAudio.Sound.prototype._loadAndDecodeSound\t= function(url, onLoad, onError){\n\tvar context\t= this._context;\n\tvar request\t= new XMLHttpRequest();\n\trequest.open('GET', url, true);\n\trequest.responseType\t= 'arraybuffer';\n\t// Decode asynchronously\n\trequest.onload\t= function() {\n\t\tcontext.decodeAudioData(request.response, function(buffer) {\n\t\t\tonLoad && onLoad(buffer);\n\t\t}, function(){\n\t\t\tonError && onError();\n\t\t});\n\t};\n\t// actually start the request\n\trequest.send();\n}\n/**\n * gowiththeflow.js - a javascript flow control micro library\n * https://github.com/jeromeetienne/gowiththeflow.js\n*/\nWebAudio.Flow\t= function(){\n\tvar self, stack = [], timerId = setTimeout(function(){ timerId = null; self._next(); }, 0);\n\treturn self = {\n\t\tdestroy : function(){ timerId && clearTimeout(timerId); },\n\t\tpar\t: function(callback, isSeq){\n\t\t\tif(isSeq || !(stack[stack.length-1] instanceof Array)) stack.push([]);\n\t\t\tstack[stack.length-1].push(callback);\n\t\t\treturn self;\n\t\t},seq\t: function(callback){ return self.par(callback, true);\t},\n\t\t_next\t: function(err, result){\n\t\t\tvar errors = [], results = [], callbacks = stack.shift() || [], nbReturn = callbacks.length, isSeq = nbReturn == 1;\n\t\t\tfor(var i = 0; i < callbacks.length; i++){\n\t\t\t\t(function(fct, index){\n\t\t\t\t\tfct(function(error, result){\n\t\t\t\t\t\terrors[index]\t= error;\n\t\t\t\t\t\tresults[index]\t= result;\t\t\n\t\t\t\t\t\tif(--nbReturn == 0)\tself._next(isSeq?errors[0]:errors, isSeq?results[0]:results)\n\t\t\t\t\t}, err, result)\n\t\t\t\t})(callbacks[i], i);\n\t\t\t}\n\t\t}\n\t}\n};\n\n// This THREEx helper makes it easy to handle the fullscreen API\n// * it hides the prefix for each browser\n// * it hides the little discrepencies of the various vendor API\n// * at the time of this writing (nov 2011) it is available in \n//   [firefox nightly](http://blog.pearce.org.nz/2011/11/firefoxs-html-full-screen-api-enabled.html),\n//   [webkit nightly](http://peter.sh/2011/01/javascript-full-screen-api-navigation-timing-and-repeating-css-gradients/) and\n//   [chrome stable](http://updates.html5rocks.com/2011/10/Let-Your-Content-Do-the-Talking-Fullscreen-API).\n\n// \n// # Code\n\n//\n\n/** @namespace */\nvar THREEx\t\t= THREEx \t\t|| {};\nTHREEx.FullScreen\t= THREEx.FullScreen\t|| {};\n\n/**\n * test if it is possible to have fullscreen\n * \n * @returns {Boolean} true if fullscreen API is available, false otherwise\n*/\nTHREEx.FullScreen.available\t= function()\n{\n\treturn this._hasWebkitFullScreen || this._hasMozFullScreen;\n}\n\n/**\n * test if fullscreen is currently activated\n * \n * @returns {Boolean} true if fullscreen is currently activated, false otherwise\n*/\nTHREEx.FullScreen.activated\t= function()\n{\n\tif( this._hasWebkitFullScreen ){\n\t\treturn document.webkitIsFullScreen;\n\t}else if( this._hasMozFullScreen ){\n\t\treturn document.mozFullScreen;\n\t}else{\n\t\tconsole.assert(false);\n\t}\n}\n\n/**\n * Request fullscreen on a given element\n * @param {DomElement} element to make fullscreen. optional. default to document.body\n*/\nTHREEx.FullScreen.request\t= function(element)\n{\n\telement\t= element\t|| document.body;\n\tif( this._hasWebkitFullScreen ){\n\t\telement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);\n\t}else if( this._hasMozFullScreen ){\n\t\telement.mozRequestFullScreen();\n\t}else{\n\t\tconsole.assert(false);\n\t}\n}\n\n/**\n * Cancel fullscreen\n*/\nTHREEx.FullScreen.cancel\t= function()\n{\n\tif( this._hasWebkitFullScreen ){\n\t\tdocument.webkitCancelFullScreen();\n\t}else if( this._hasMozFullScreen ){\n\t\tdocument.mozCancelFullScreen();\n\t}else{\n\t\tconsole.assert(false);\n\t}\n}\n\n\n// internal functions to know which fullscreen API implementation is available\nTHREEx.FullScreen._hasWebkitFullScreen\t= 'webkitCancelFullScreen' in document\t? true : false;\t\nTHREEx.FullScreen._hasMozFullScreen\t= 'mozCancelFullScreen' in document\t? true : false;\t\n\n/**\n * Bind a key to renderer screenshot\n*/\nTHREEx.FullScreen.bindKey\t= function(opts){\n\topts\t\t= opts\t\t|| {};\n\tvar charCode\t= opts.charCode\t|| 'f'.charCodeAt(0);\n\tvar dblclick\t= opts.dblclick !== undefined ? opts.dblclick : false;\n\tvar element\t= opts.element\n\n\tvar toggle\t= function(){\n\t\tif( THREEx.FullScreen.activated() ){\n\t\t\tTHREEx.FullScreen.cancel();\n\t\t}else{\n\t\t\tTHREEx.FullScreen.request(element);\n\t\t}\t\t\n\t}\n\n\t// callback to handle keypress\n\tvar __bind\t= function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\tvar onKeyPress\t= __bind(function(event){\n\t\t// return now if the KeyPress isnt for the proper charCode\n\t\tif( event.which !== charCode )\treturn;\n\t\t// toggle fullscreen\n\t\ttoggle();\n\t}, this);\n\n\t// listen to keypress\n\t// NOTE: for firefox it seems mandatory to listen to document directly\n\tdocument.addEventListener('keypress', onKeyPress, false);\n\t// listen to dblclick\n\tdblclick && document.addEventListener('dblclick', toggle, false);\n\n\treturn {\n\t\tunbind\t: function(){\n\t\t\tdocument.removeEventListener('keypress', onKeyPress, false);\n\t\t\tdblclick && document.removeEventListener('dblclick', toggle, false);\n\t\t}\n\t};\n}\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author marklundin / http://mark-lundin.com/\n * @author alteredq / http://alteredqualia.com/\n */\n\nTHREE.AnaglyphEffect = function ( renderer, width, height ) {\n\n\tvar eyeRight = new THREE.Matrix4();\n\tvar eyeLeft = new THREE.Matrix4();\n\tvar focalLength = 125;\n\tvar _aspect, _near, _far, _fov;\n\n\tvar _cameraL = new THREE.PerspectiveCamera();\n\t_cameraL.matrixAutoUpdate = false;\n\n\tvar _cameraR = new THREE.PerspectiveCamera();\n\t_cameraR.matrixAutoUpdate = false;\n\n\tvar _camera = new THREE.OrthographicCamera( -1, 1, 1, - 1, 0, 1 );\n\n\tvar _scene = new THREE.Scene();\n\n\tvar _params = { minFilter: THREE.LinearFilter, magFilter: THREE.NearestFilter, format: THREE.RGBAFormat };\n\n\tif ( width === undefined ) width = 512;\n\tif ( height === undefined ) height = 512;\n\n\tvar _renderTargetL = new THREE.WebGLRenderTarget( width, height, _params );\n\tvar _renderTargetR = new THREE.WebGLRenderTarget( width, height, _params );\n\n\tvar _material = new THREE.ShaderMaterial( {\n\n\t\tuniforms: {\n\n\t\t\t\"mapLeft\": { type: \"t\", value: _renderTargetL },\n\t\t\t\"mapRight\": { type: \"t\", value: _renderTargetR }\n\n\t\t},\n\n\t\tvertexShader: [\n\n\t\t\t\"varying vec2 vUv;\",\n\n\t\t\t\"void main() {\",\n\n\t\t\t\"\tvUv = vec2( uv.x, uv.y );\",\n\t\t\t\"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\n\n\t\t\t\"}\"\n\n\t\t].join(\"\\n\"),\n\n\t\tfragmentShader: [\n\n\t\t\t\"uniform sampler2D mapLeft;\",\n\t\t\t\"uniform sampler2D mapRight;\",\n\t\t\t\"varying vec2 vUv;\",\n\n\t\t\t\"void main() {\",\n\n\t\t\t\"\tvec4 colorL, colorR;\",\n\t\t\t\"\tvec2 uv = vUv;\",\n\n\t\t\t\"\tcolorL = texture2D( mapLeft, uv );\",\n\t\t\t\"\tcolorR = texture2D( mapRight, uv );\",\n\n\t\t\t\t// http://3dtv.at/Knowhow/AnaglyphComparison_en.aspx\n\n\t\t\t\"\tgl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;\",\n\n\t\t\t\"}\"\n\n\t\t].join(\"\\n\")\n\n\t} );\n\n\tvar mesh = new THREE.Mesh( new THREE.PlaneGeometry( 2, 2 ), _material );\n\t_scene.add( mesh );\n\n\tthis.setSize = function ( width, height ) {\n\n\t\tif ( _renderTargetL ) _renderTargetL.dispose();\n\t\tif ( _renderTargetR ) _renderTargetR.dispose();\n\t\t_renderTargetL = new THREE.WebGLRenderTarget( width, height, _params );\n\t\t_renderTargetR = new THREE.WebGLRenderTarget( width, height, _params );\n\n\t\t_material.uniforms[ \"mapLeft\" ].value = _renderTargetL;\n\t\t_material.uniforms[ \"mapRight\" ].value = _renderTargetR;\n\n\t\trenderer.setSize( width, height );\n\n\t};\n\n\t/*\n\t * Renderer now uses an asymmetric perspective projection\n\t * (http://paulbourke.net/miscellaneous/stereographics/stereorender/).\n\t *\n\t * Each camera is offset by the eye seperation and its projection matrix is\n\t * also skewed asymetrically back to converge on the same projection plane.\n\t * Added a focal length parameter to, this is where the parallax is equal to 0.\n\t */\n\n\tthis.render = function ( scene, camera ) {\n\n\t\tscene.updateMatrixWorld();\n\n\t\tif ( camera.parent === undefined ) camera.updateMatrixWorld();\n\n\t\tvar hasCameraChanged = ( _aspect !== camera.aspect ) || ( _near !== camera.near ) || ( _far !== camera.far ) || ( _fov !== camera.fov );\n\n\t\tif ( hasCameraChanged ) {\n\n\t\t\t_aspect = camera.aspect;\n\t\t\t_near = camera.near;\n\t\t\t_far = camera.far;\n\t\t\t_fov = camera.fov;\n\n\t\t\tvar projectionMatrix = camera.projectionMatrix.clone();\n\t\t\t// var eyeSep = focalLength / 30 * 0.5;\n\t\t\tvar eyeSep = 0.05;\n\t\t\t// var eyeSepOnProjection = eyeSep * _near / focalLength;\n\t\t\tvar eyeSepOnProjection = 0;\n\t\t\tvar ymax = _near * Math.tan( THREE.Math.degToRad( _fov * 0.5 ) );\n\t\t\tvar xmin, xmax;\n\n\t\t\t// translate xOffset\n\n\t\t\teyeRight.elements[12] = eyeSep;\n\t\t\teyeLeft.elements[12] = -eyeSep;\n\n\t\t\t// for left eye\n\n\t\t\txmin = -ymax * _aspect + eyeSepOnProjection;\n\t\t\txmax = ymax * _aspect + eyeSepOnProjection;\n\n\t\t\tprojectionMatrix.elements[0] = 2 * _near / ( xmax - xmin );\n\t\t\tprojectionMatrix.elements[8] = ( xmax + xmin ) / ( xmax - xmin );\n\n\t\t\t_cameraL.projectionMatrix.copy( projectionMatrix );\n\n\t\t\t// for right eye\n\n\t\t\txmin = -ymax * _aspect - eyeSepOnProjection;\n\t\t\txmax = ymax * _aspect - eyeSepOnProjection;\n\n\t\t\tprojectionMatrix.elements[0] = 2 * _near / ( xmax - xmin );\n\t\t\tprojectionMatrix.elements[8] = ( xmax + xmin ) / ( xmax - xmin );\n\n\t\t\t_cameraR.projectionMatrix.copy( projectionMatrix );\n\n\t\t}\n\n\t\t_cameraL.matrixWorld.copy( camera.matrixWorld ).multiply( eyeLeft );\n\t\t_cameraL.position.copy( camera.position );\n\t\t_cameraL.near = camera.near;\n\t\t_cameraL.far = camera.far;\n\n\t\trenderer.render( scene, _cameraL, _renderTargetL, true );\n\n\t\t_cameraR.matrixWorld.copy( camera.matrixWorld ).multiply( eyeRight );\n\t\t_cameraR.position.copy( camera.position );\n\t\t_cameraR.near = camera.near;\n\t\t_cameraR.far = camera.far;\n\n\t\trenderer.render( scene, _cameraR, _renderTargetR, true );\n\n\t\trenderer.render( _scene, _camera );\n\n\t};\n\n\tthis.dispose = function() {\n\t\tif ( _renderTargetL ) _renderTargetL.dispose();\n\t\tif ( _renderTargetR ) _renderTargetR.dispose();\n\t}\n\n};\n\n//                 \n//           \n//                          \n//                            \n//                          \n//                             \n                                                                                \nvar DT = (function () {\n    'use strict';\n    var DT = {},\n        THREE = window.THREE || undefined,\n        WebAudio = window.WebAudio || undefined,\n        $ = window.$ || undefined,\n        THREEx = window.THREEx || undefined,\n        requestAnimFrame = function () {\n            return (\n                window.requestAnimationFrame       ||\n                window.webkitRequestAnimationFrame ||\n                window.mozRequestAnimationFrame    ||\n                window.oRequestAnimationFrame      ||\n                window.msRequestAnimationFrame     ||\n                function(/* function */ callback){\n                    window.setTimeout(callback, 1000 / 60);\n                }\n            );\n        }(),\n        cancelAnimFrame = function () {\n            return (\n                window.cancelAnimationFrame       ||\n                window.webkitCancelAnimationFrame ||\n                window.mozCancelAnimationFrame    ||\n                window.oCancelAnimationFrame      ||\n                window.msCancelAnimationFrame     ||\n                function(id){\n                    window.clearTimeout(id);\n                }\n            );\n        }();\n\n//                      \n//               \n//                                      \n//                                  \n//                      \n//                                \n                                                                                                                          \n    DT.getCookie = function (name) {\n        var matches = document.cookie.match(\n            new RegExp('(?:^|; )' + name.replace(/([\\.$?*|{}\\(\\)\\[\\]\\\\\\/\\+^])/g, '\\\\$1') + '=([^;]*)')\n        );\n        return matches ? decodeURIComponent(matches[1]) : undefined;\n    };\n    DT.getDistance = function (x1, y1, z1, x2, y2, z2) {\n        return Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2) + (z1 - z2) * (z1 - z2));\n    };\n    DT.genCoord = function (delta) {\n        var offset = delta || DT.game.param.spacing,\n        x = Math.random() * offset * 2 - offset,\n        absX = Math.abs(x);\n        if (absX <= offset && absX >= offset * 0.33 ) {\n            if (x > 0) {\n                return offset;\n            }\n            if (x < 0) {\n                return offset * -1;\n            }\n        } else {\n            return 0;\n        }\n    };\n    DT.genRandomFloorBetween = function (min, max) {\n        var rand = min - 0.5 + Math.random()*(max-min+1);\n        rand = Math.round(rand);\n        return rand;\n    };\n    DT.genRandomBetween = function (min, max) {\n        return Math.random() * (max - min) + min;\n    };\n    DT.genRandomSign = function () {\n        var signVal = Math.random() - 0.5;\n        return Math.abs(signVal)/signVal;\n    };\n\n    DT.animate = function (nowMsec) {\n        nowMsec = nowMsec || Date.now();\n        DT.animate.lastTimeMsec = DT.animate.lastTimeMsec || nowMsec - 1000 / 60;\n        var deltaMsec = Math.min(200, nowMsec - DT.animate.lastTimeMsec);\n        // keep looping\n        DT.animate.id = requestAnimFrame(DT.animate);\n        // change last time\n        DT.animate.lastTimeMsec = nowMsec;\n        // call each update function\n        $(document).trigger('update', {\n            delta: deltaMsec / 1000,\n            now: nowMsec / 1000\n        });\n    };\n\n//                     \n//                \n   //                        \n   //                      \n   //              \n   //                   \n                                                                                        \n    DT.renderer = new THREE.WebGLRenderer();\n    DT.renderer.setSize(window.innerWidth, window.innerHeight);\n    DT.renderer.physicallyBasedShading = true;\n    document.body.appendChild(DT.renderer.domElement);\n\n    DT.camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 1, 300);\n    DT.camera.position.set(0, 0.5, 15);\n    DT.camera.position.z = DT.camera.z = 15;\n    var lens = DT.camera.lens = 35;\n\n    DT.scene = new THREE.Scene();\n    \n    DT.lights = {\n        light: new THREE.PointLight(0xffffff, 0.75, 100),\n        directionalLight: new THREE.DirectionalLight(0xffffff, 0.25)\n    };\n    DT.lights.light.position.set(0, 0, -1);\n    DT.scene.add(DT.lights.light);\n\n    DT.lights.directionalLight.position.set(0, 0, 1);\n    DT.scene.add(DT.lights.directionalLight);\n\n    // BACKGROUND\n    DT.bgTexture = THREE.ImageUtils.loadTexture('img/bg.jpg');\n    DT.backgroundMesh = new THREE.Mesh(\n        new THREE.PlaneGeometry(44, 22, 0),\n        new THREE.MeshBasicMaterial({\n            map: DT.bgTexture\n        }));\n    DT.backgroundMesh.material.depthTest = false;\n    DT.backgroundMesh.material.depthWrite = false;\n    DT.backgroundMesh.visible = false;\n    DT.scene.add(DT.backgroundMesh);\n\n   // when resize\n    var winResize = new THREEx.WindowResize(DT.renderer, DT.camera);\n\n    // EFFECT\n    DT.effect = new THREE.AnaglyphEffect(DT.renderer);\n\n    // TODO: refactor\n    // render the scene\n    $(document).on('update', function (e, data) {\n        DT.renderer.render(DT.scene, DT.camera);\n        if (DT.player.isFun) {\n            DT.effect.render(DT.scene, DT.camera);\n            DT.effect.setSize( window.innerWidth, window.innerHeight );\n        }\n        if (!DT.backgroundMesh.visible) {\n            DT.backgroundMesh.visible = true;\n        }\n        if ( DT.animation ) {\n            DT.animation.update( data.delta*1000 );\n        }\n    });\n    // LENS\n    $(document).on('update', function (e, data) {\n        var camOffset = 6, camDelta = 0.1,\n            lensOffset = 18, lensDelta = 0.3;\n        if (DT.game.speed.getChanger() > 0) {\n            DT.camera.position.z = Math.max(DT.camera.position.z -= camDelta, DT.camera.z - camOffset);\n            lens = Math.max(lens -= lensDelta, DT.camera.lens - lensOffset);\n        } else if (DT.game.speed.getChanger() < 0) {\n            DT.camera.position.z = Math.min(DT.camera.position.z += camDelta, DT.camera.z + camOffset);\n            lens = Math.min(lens += lensDelta, DT.camera.lens + lensOffset);\n        } else {\n            var delta = DT.camera.lens - lens;\n            if (delta < 0) {\n                DT.camera.position.z = Math.max(DT.camera.position.z -= camDelta, DT.camera.z);\n                lens = Math.max(lens -= lensDelta, DT.camera.lens);\n            } else {\n                DT.camera.position.z = Math.min(DT.camera.position.z += camDelta, DT.camera.z);\n                lens = Math.min(lens += lensDelta, DT.camera.lens);\n            }\n        }\n        DT.camera.setLens(lens);\n    });\n    // change IcosahedronGeometry prototype\n    THREE.IcosahedronGeometry = function ( radius, detail ) {\n        this.radius = radius;\n        this.detail = detail;\n        var t = ( 1 + Math.sqrt( 5 ) ) / 2;\n        var vertices = [\n            [ -1,  t,  0 ], [  1, t, 0 ], [ -1, -t,  0 ], [  1, -t,  0 ],\n            [  0, -1,  t ], [  0, 1, t ], [  0, -1, -t ], [  0,  1, -t ],\n            [  t,  0, -1 ], [  t, 0, 1 ], [ -t,  0, -1 ], [ -t,  0,  1 ]\n        ];\n        vertices = vertices.map(function(el) {\n            return el.map(function(el) {\n                return el * Math.random();\n            });\n        });\n        var faces = [\n            [ 0, 11,  5 ], [ 0,  5,  1 ], [  0,  1,  7 ], [  0,  7, 10 ], [  0, 10, 11 ],\n            [ 1,  5,  9 ], [ 5, 11,  4 ], [ 11, 10,  2 ], [ 10,  7,  6 ], [  7,  1,  8 ],\n            [ 3,  9,  4 ], [ 3,  4,  2 ], [  3,  2,  6 ], [  3,  6,  8 ], [  3,  8,  9 ],\n            [ 4,  9,  5 ], [ 2,  4, 11 ], [  6,  2, 10 ], [  8,  6,  7 ], [  9,  8,  1 ]\n        ];\n        THREE.PolyhedronGeometry.call( this, vertices, faces, radius, detail );\n    };\n    THREE.IcosahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\n\n//                             \n//                  \n//                                   \n//                                  \n//                   \n//                           \n\n    DT.listOfModels = [\n        {\n            name: 'bonusH',\n            scale: {x: 0.02, y: 0.02, z: 0.02},\n            rotation: {x: Math.PI / 1.3, y: -Math.PI / 1.3, z: -Math.PI / 1.3}\n        },\n        {\n            name: 'bonusI',\n            scale: {x: 0.5, y: 0.5, z: 0.5},\n            rotation: {x: Math.PI / 1.3, y: -Math.PI / 1.3, z: -Math.PI / 1.3}\n        },\n        {\n            name: 'bonusE',\n            scale: {x: 0.025, y: 0.025, z: 0.025},\n            rotation: {x: 0, y: 0, z: 0}\n        }\n    ];\n    // LOADER\n    var loader = new THREE.JSONLoader(true), // init the loader util\n        loadModel;\n    \n        // init loading\n    loadModel = function(modelObj) {\n        loader.load('js/models/' + modelObj.name + '.js', function (geometry, materials) {\n            // create a new material\n            if (modelObj.name === 'bonusE') {\n                modelObj.material = new THREE.MeshLambertMaterial( { color: 0x606060, morphTargets: true } );\n                modelObj.material.emissive.r = modelObj.material.color.r * 0.5;\n                modelObj.material.emissive.g = modelObj.material.color.g * 0.5;\n                modelObj.material.emissive.b = modelObj.material.color.b * 0.5;\n            } else {\n                modelObj.material = new THREE.MeshFaceMaterial( materials );\n                // shining of bonuses\n                modelObj.material.materials.forEach(function (el) {\n                    el.emissive.r = el.color.r * 0.5;\n                    el.emissive.g = el.color.g * 0.5;\n                    el.emissive.b = el.color.b * 0.5;\n                });\n            }\n            modelObj.geometry = geometry;\n        });\n        return modelObj;\n    };\n    DT.listOfModels.map(loadModel);\n\n//       \n//      \n//               \n//            \n//          \n//             \n                                                    \n    DT.events = {\n        'startGame'     : 'custom',\n        'pauseGame'     : 'custom',\n        'resumeGame'    : 'custom',\n        'resetGame'     : 'custom',\n        'update'        : 'custom',\n        'changeSpeed'   : 'custom',\n        'makeFun'       : 'custom',\n        'stopFun'       : 'custom',\n        'changeHelth'   : 'custom',\n        'showHelth'     : 'custom',\n        'changeScore'   : 'custom',\n        'showScore'     : 'custom',\n        'blink'         : 'custom',\n        'focus'         : 'native',\n        'blur'          : 'native',\n    };\n\n    $(document).on('startGame', function (e, data) {\n        DT.animate.id = requestAnimFrame(DT.animate);\n    });\n    $(document).on('pauseGame', function () {\n        cancelAnimFrame(DT.animate.id);\n    });\n    $(document).on('resumeGame', function (e, data) {\n        DT.animate.id = requestAnimFrame(DT.animate);\n    });\n    $(document).on('gameOver', function (e, data) {\n        setTimeout(function() {\n            cancelAnimFrame(DT.animate.id);\n        }, 300);\n    });\n\n //       \n//   \n//     \n//      \n//     \n //         \n                                    \n    DT.Game = function () {\n        this.param = {\n            spacing: 3,\n            spawnCoord: -200,\n            opacityCoord: 2,\n            dieCoord: 30,\n            stonesCloseness: 18,\n            globalVolume: 1,\n            prevGlobalVolume: 1\n        };\n        this.speed = {\n            value: 36,\n            changer: 0,\n            step: 0.6,\n            increase: function () {\n                this.value += (this.step / 60);\n            },\n            setChanger: function (changer) {\n                this.changer = changer;\n            },\n            getChanger: function() {\n                return this.changer;\n            },\n            getValue: function () {\n                return (this.value + this.changer) / 60;\n            }\n        };\n        this.wasStarted = false;\n        this.wasPaused = false;\n        this.wasOver = false;\n        this.wasMuted = false;\n        this.timer = 0;\n    };\n    DT.Game.prototype.startGame = function() {\n        this.wasStarted = true;\n    };\n\n    DT.Game.prototype.updateTimer = function () {\n        this.timer += 1;\n        if (this.timer % 60 === 0) {\n            var sec, min;\n            sec = this.timer / 60;\n            min = Math.floor(sec / 60);\n            sec = sec % 60;\n            sec = sec < 10 ? '0' + sec.toString() : sec;\n            $('.gameTimer').html(min + ':' + sec);\n            $('title').html(min + ':' + sec + ' in digital trip');\n        }\n    };\n    DT.Game.prototype.update = function() {\n        this.updateTimer();\n        this.speed.increase();\n    };\n    DT.Game.prototype.reset = function() {\n        $(document).trigger('resetGame', {});\n        this.timer = 0;\n    };\n    DT.Game.prototype.gameOver = function() {\n        this.wasOver = true;\n    };\n\n    DT.game = new DT.Game();\n\n    $(document).on('startGame', function (e, data) {\n        DT.game.startGame();\n    });\n    $(document).on('pauseGame', function () {\n        DT.game.wasPaused = true;\n    });\n    $(document).on('resumeGame', function (e, data) {\n        DT.game.wasPaused = false;\n        DT.game.startGame();\n    });\n    $(document).on('update', function (e, data) {\n        DT.game.update();\n    });\n    $(document).on('changeSpeed', function (e, data) {\n        DT.game.speed.setChanger(data.changer);\n    });\n    $(document).on('gameOver', function (e, data) {\n        DT.game.gameOver();\n    });\n\n//             \n//       \n//          \n//             \n//                \n//                \n                                                 \n    DT.Player = function (options) {\n        if (!DT.Player.__instance) {\n            DT.Player.__instance = this;\n        } else {\n            return DT.Player.__instance;\n        }\n        var self = this;\n        this.scene = options.scene || DT.scene;\n        this.currentHelth = options.currentHelth || 100;\n        this.currentScore = options.currentScore || 0;\n        this.destPoint = options.destPoint || {x: 0, y: 0};\n        this.isInvulnerability = options.isInvulnerability || false;\n        this.isFun = options.isFun || false;\n        this.invulnerTimer = null;\n        this.funTimer = null;\n        this.sphere = new THREE.Mesh(new THREE.SphereGeometry(0.5, 32, 32), new THREE.MeshPhongMaterial({color: 0xff0000}));\n        this.sphere.position.set(0, -2.5, 0);\n        this.light = new THREE.PointLight(0xff0000, 1.75, 15);\n        this.light.position.set(0, 0, 0);\n        this.light.color = this.sphere.material.color;\n        this.scene.add(this.light);\n        this.blink = {\n            color: new THREE.Color('red'),\n            frames: 0,\n            framesLeft: 0,\n            dr: 0,\n            dg: 0,\n            db: 0,\n            doBlink: function (color, frames) {\n                var defClr = {r: 1, g: 0, b: 0};\n                this.color = new THREE.Color(color);\n                this.frames = frames;\n                this.framesLeft = frames;\n                this.dr = (defClr.r - this.color.r)/frames;\n                this.dg = (defClr.g - this.color.g)/frames;\n                this.db = (defClr.b - this.color.b)/frames;\n\n            },\n        };\n        this.emitter = Fireworks.createEmitter({nParticles : 100})\n        .effectsStackBuilder()\n            .spawnerSteadyRate(25)\n            .position(Fireworks.createShapePoint(0, 0, 0))\n            .velocity(Fireworks.createShapePoint(0, 0, 2))\n            .lifeTime(0.7, 0.7)\n            .randomVelocityDrift(Fireworks.createVector(0, 0, 0))\n            .renderToThreejsParticleSystem({\n                particleSystem  : function(emitter){\n                    var i,\n                        geometry    = new THREE.Geometry(),\n                        texture = Fireworks.ProceduralTextures.buildTexture(),\n                        material    = new THREE.ParticleBasicMaterial({\n                            color       : new THREE.Color().setHSL(1, 0, 0.3).getHex(),\n                            size        : 100,\n                            sizeAttenuation : false,\n                            vertexColors    : true,\n                            map     : texture,\n                            blending    : THREE.AdditiveBlending,\n                            depthWrite  : false,\n                            transparent : true\n                        }),\n                        particleSystem = new THREE.ParticleSystem(geometry, material);\n                        particleSystem.dynamic  = true;\n                        particleSystem.sortParticles = true;\n                    // init vertices\n                    for(i = 0; i < emitter.nParticles(); i++){\n                        geometry.vertices.push( new THREE.Vector3() );\n                    }\n                    // init colors\n                    geometry.colors = new Array(emitter.nParticles());\n                    for(i = 0; i < emitter.nParticles(); i++){\n                        geometry.colors[i]  = self.sphere.material.color;\n                    }\n                    \n                    self.scene.add(particleSystem);\n                    particleSystem.position = self.sphere.position;\n                    return particleSystem;\n                }\n            }).back()\n        .start();\n    };\n\n    DT.Player.prototype.updateBlink = function () {\n        // TODO: refactor\n        if (this.blink.framesLeft === 0) {\n            return;\n        }\n        if (this.blink.framesLeft === 1) {\n            this.sphere.material.color.setRGB(1,0,0)\n        }\n        if (this.blink.framesLeft === this.blink.frames) {\n            this.sphere.material.color.setRGB(this.blink.color.r,this.blink.color.g,this.blink.color.b);\n        }\n        if (this.blink.framesLeft < this.blink.frames) {\n            this.sphere.material.color.r += this.blink.dr;\n            this.sphere.material.color.g += this.blink.dg;\n            this.sphere.material.color.b += this.blink.db;\n        }\n        this.blink.framesLeft -= 1;\n        return this;\n    };\n\n    DT.Player.prototype.changeHelth = function(delta) {\n        if (delta > 0 || this.isInvulnerability === false) {\n            var helth = this.currentHelth;\n            if (helth > 0) {\n                helth += delta;\n                if (helth < 0) {\n                    helth = 0;\n                    $(document).trigger('gameOver', {});\n                }\n                if (helth > 100) {\n                    helth = 100;\n                }\n            }\n            this.currentHelth = helth;\n            $(document).trigger('showHelth', {helth: this.currentHelth});\n        }\n        return this;\n    };\n\n    DT.Player.prototype.makeInvulner = function (time) {\n        this.invulnerTimer = (time || 10000) / 1000 * 60;\n        this.isInvulnerability = true;\n        $(document).trigger('showInvulner', {invulner: true});\n        return this;\n    };\n\n    DT.Player.prototype.stopInvulner = function () {\n        this.invulnerTimer = 0;\n        this.isInvulnerability = false;\n        $(document).trigger('showInvulner', {invulner: false});\n        return this;\n    };\n\n    DT.Player.prototype.changeScore = function(delta) {\n        this.currentScore += delta;\n        $(document).trigger('showScore', {score: this.currentScore});\n        return this;\n    };\n\n    DT.Player.prototype.makeFun = function(time) {\n        this.isFun = true;\n        this.funTimer = (time || 10000) / 1000 * 60;\n        $(document).trigger('showFun', {isFun: true});\n        return this;\n    };\n\n    DT.Player.prototype.stopFun = function () {\n        this.isFun = false;\n        this.funTimer = 0;\n        $(document).trigger('showFun', {isFun: false});\n        return this;\n    };\n\n    DT.Player.prototype.updateInvulnerability = function () {\n        if (this.isInvulnerability) {\n            this.invulnerTimer -= 1;\n            if (this.invulnerTimer <= 0) {\n                this.isInvulnerability = false;\n                $(document).trigger('showInvulner', {invulner: false});\n            } else {\n                return this;\n            }\n        }\n        return this;\n    };\n\n    DT.Player.prototype.updateFun = function () {\n        if (this.isFun) {\n            this.funTimer -= 1;\n            if (this.funTimer <= 0) {\n                this.stopFun();\n            } else if (this.funTimer % 6 === 0) {\n                var color = new THREE.Color().setRGB(\n                    DT.genRandomFloorBetween(0, 3),\n                    DT.genRandomFloorBetween(0, 3),\n                    DT.genRandomFloorBetween(0, 3)\n                );\n                this.blink.doBlink(color, 10);\n            }\n        }\n        return this;\n    };\n\n    DT.Player.prototype.update = function () {\n        this.updateInvulnerability();\n        this.updateFun();\n        this.updateBlink();\n        return this;\n    };\n\n    DT.Player.prototype.reset = function () {\n        this.currentHelth = 100;\n        this.currentScore = 0;\n        this.destPoint = {x: 0, y: -2.5};\n        this.isInvulnerability = false;\n        this.isFun = false;\n        return this;\n    };\n\n    DT.Player.prototype.changeDestPoint = function(dy, dx) {\n        if ((this.destPoint.x < DT.game.param.spacing && dx > 0) || (this.destPoint.x > -DT.game.param.spacing && dx < 0)) {\n            this.destPoint.x += dx * DT.game.param.spacing;\n        }\n        return this;\n    };\n\n    DT.Player.prototype.moveSphere = function(n) {\n        // TODO: refactor\n        var i, self = this,\n            iterator = function(aix) {\n            var dx = self.destPoint[aix] - self.sphere.position[aix];\n            if (Math.abs(dx) > 0.01) {\n                self.sphere.position[aix] += dx > 0 ? 0.1 : -0.1;\n            }\n        };\n        for (i = 0; i < n; i++) {\n            ['x'].forEach(iterator);\n        }\n            ['y'].forEach(function(aix) {\n                var dx = self.destPoint[aix] - self.sphere.position[aix];\n                if (Math.abs(dx) > 0.01) {\n                    self.sphere.position[aix] += dx > 0 ? 0.1 : -0.1;\n                }\n            });\n        return this;\n    };\n\n    DT.Player.prototype.bump = function (amp) {\n        if (this.isInvulnerability) return;\n        for (var i = 0; i < 2; i++) {\n            amp = amp || 0.15;\n            this.sphere.position.x += DT.genRandomSign() * amp;\n            this.sphere.position.y += DT.genRandomSign() * amp;\n        }\n        return this;\n     };\n\n    DT.player = new DT.Player({\n        currentHelth: 100,\n        currentScore: 0,\n        destPoint: {x: 0, y: -2.5},\n        isInvulnerability: false,\n        isFun: false\n    });\n    $(document).on('update', function (e, data) {\n        DT.player.update();\n    });\n    // TODO: refactor\n    $(document).on('update', function (e, data) {\n        DT.player.moveSphere(3);\n        DT.player.light.position.x = DT.player.sphere.position.x;\n        DT.player.light.position.y = DT.player.sphere.position.y;\n    });\n    $(document).on('update', function (e, data) {\n        DT.player.emitter.update(data.delta).render();\n        DT.player.emitter._particles.forEach(function(el) {\n            el.velocity.vector.z += DT.audio.valueAudio/28;\n        });\n    });\n    $(document).on('makeFun', function (e, data) {\n        DT.player.makeFun();\n    });\n    $(document).on('stopFun', function (e, data) {\n        DT.player.stopFun();\n    });\n    $(document).on('changeScore', function (e, data) {\n        DT.player.changeScore(data.delta);\n    });\n    $(document).on('changeHelth', function (e, data) {\n        DT.player.changeHelth(data.delta);\n    });\n    $(document).on('makeInvulner', function (e, data) {\n        DT.player.makeInvulner();\n    });\n    $(document).on('stopInvulner', function (e, data) {\n        DT.player.stopInvulner();\n    });\n    $(document).on('blink', function (e, data) {\n        DT.player.blink.doBlink(data.color, data.frames);\n    });\n    $(document).on('gameOver', function (e, data) {\n        clearTimeout(DT.player.isFun);\n    });\n\n //                    \n//            \n//                              \n//                             \n//               \n //                         \n                                                                                          \n    DT.GameObject = function (options) {\n        this.tObject = new options.THREEConstructor(\n            options.geometry,\n            options.material\n        );\n        this.geometry = this.tObject.geometry;\n        this.material = this.tObject.material;\n        this.scene = options.scene || DT.scene;\n    };\n    DT.GameObject.prototype.addToScene = function () {\n        this.scene.add(this.tObject);\n        return this;\n    };\n    DT.GameObject.prototype.removeFromScene = function () {\n        this.scene.remove(this.tObject);\n        return this;\n    };\n    DT.GameObject.prototype.create = function () {\n        // empty method\n        console.log('try to call empty method');\n        return this;\n    };\n    DT.GameObject.prototype.createAndAdd = function () {\n        return this.create()\n            .addToScene();\n    };\n    DT.GameObject.prototype.update = function (options) {\n        return this.updateGeometry(options.geometry)\n            .updateMaterial(options.material);\n    };\n    DT.GameObject.prototype.updateGeometry = function (options) {\n        // empty method\n        console.log('try to call empty method');\n        return this;\n    };\n    DT.GameObject.prototype.updateMaterial = function (options) {\n        // empty method\n        console.log('try to call empty method');\n        return this;\n    };\n    DT.GameObject.prototype.updateParam = function (param, options) {\n        for (var prop in options) if (options.hasOwnProperty(prop)) {\n            this.tObject[param][prop] += options[prop];\n        }\n        return this;\n    };\n    DT.GameObject.prototype.setParam = function (param, options) {\n        for (var prop in options) if (options.hasOwnProperty(prop)) {\n            this.tObject[param][prop] = options[prop];\n        }\n        return this;\n    };\n\n //                                    \n//                          \n//                                       \n//                                      \n//             \n //                         \n                                                                                                      \n    DT.GameCollectionObject = function (options) {\n        DT.GameObject.apply(this, arguments);\n        this.collection = options.collection;\n    };\n    DT.GameCollectionObject.prototype = Object.create(DT.GameObject.prototype);\n    DT.GameCollectionObject.prototype.constructor = DT.GameCollectionObject;\n\n    DT.GameCollectionObject.prototype.create = function () {\n        this.collection.push(this);\n        return this;\n    };\n\n    DT.GameCollectionObject.prototype.update = function (options) {\n        if (this.tObject.position.z > options.dieCoord) {\n            this.removeFromScene();\n        } \n        if (this.tObject.position.z > options.opacityCoord) {\n            if (this.tObject.children.length > 0) {\n                this.tObject.children.forEach(function (el) {\n                    el.material.transparent = true;\n                    el.material.opacity = 0.5; \n                });\n            } else {\n                this.tObject.material = new THREE.MeshLambertMaterial({\n                     shading: THREE.FlatShading,\n                     transparent: true,\n                     opacity: 0.5\n                 });\n            }\n        }\n        return this;\n    };\n\n    DT.GameCollectionObject.prototype.removeFromScene = function () {\n        DT.GameObject.prototype.removeFromScene.apply(this, arguments);\n        var ind = this.collection.indexOf(this);\n        if (ind !== -1) {\n            this.collection.splice(ind, 1);\n        }\n        return this;\n    };\n\n//         \n//        \n//          \n//          \n//   \n//    \n                                           \n    DT.Shield = function (options) {\n        if (!DT.Shield.__instance) {\n            DT.Shield.__instance = this;\n        } else {\n            return DT.Shield.__instance;\n        }\n        DT.GameObject.apply(this, arguments);\n        this.material.color = options.sphere.material.color;\n        this.tObject.position = options.sphere.position;\n    };\n    DT.Shield.prototype = Object.create(DT.GameObject.prototype);\n    DT.Shield.prototype.constructor = DT.Shield;\n\n    DT.shield = new DT.Shield({\n        THREEConstructor: THREE.Mesh,\n        geometry: new THREE.CubeGeometry(1.3, 1.3, 1.3, 2, 2, 2),\n        material: new THREE.MeshPhongMaterial({\n            color: 0xffffff,\n            transparent: true,\n            opacity: 0.5\n        }),\n        sphere: DT.player.sphere\n    });\n    $(document).on('showInvulner', function (e, data) {\n        console.log('showInvulner');\n        if (data.invulner) {\n            DT.shield.addToScene();\n        } else {\n            DT.shield.removeFromScene();\n        }\n    });\n\n//     \n//    \n//            \n//            \n//       \n//          \n                                  \n    DT.Dust = function (options) {\n        DT.GameObject.apply(this, arguments);\n        this.number = options.number || 100;\n        this.createAndAdd();\n    };\n    DT.Dust.prototype = Object.create(DT.GameObject.prototype);\n    DT.Dust.prototype.constructor = DT.Dust;\n\n    DT.Dust.prototype.create = function () {\n        for (var i = 0; i < this.number; i++) {\n            this.geometry.vertices.push(new THREE.Vector3(\n                DT.genRandomBetween(-10, 10),\n                DT.genRandomBetween(-10, 10),\n                DT.genRandomBetween(-100, 0)\n            ));\n        }\n        this.material.visible = false;\n        return this;\n    };\n\n    DT.Dust.prototype.updateMaterial = function (options) {\n        if (!this.material.visible) {\n            this.material.visible = true;\n        }\n        this.material.color = options.isFun ? options.color : new THREE.Color().setRGB(\n            options.valueAudio/1/1 || 70/255,\n            options.valueAudio/255/1 || 68/255,\n            options.valueAudio/255/1 || 81/255\n        );\n        return this;\n    };\n\n    DT.Dust.prototype.updateGeometry = function (options) {\n        this.geometry.vertices.forEach(function (el) {\n            el.z += options.speed;\n            if (el.z > 10) {\n                el.x = DT.genRandomBetween(-10, 10);\n                el.y = DT.genRandomBetween(-10, 10);\n                el.z = -100;\n            }\n        });\n        this.geometry.verticesNeedUpdate = true;\n        return this;\n    };\n    // Dust object \n    DT.dust = new DT.Dust({\n        geometry: new THREE.Geometry({}),\n        material: new THREE.ParticleSystemMaterial({size: 0.25}),\n        THREEConstructor: THREE.ParticleSystem\n    });\n    $(document).on('update', function (e, data) {\n        DT.dust.update({\n            material: {\n                isFun: DT.player.isFun,\n                valueAudio: DT.audio.valueAudio,\n                color: DT.player.sphere.material.color\n            }, \n            geometry: {\n                speed: DT.game.speed.getValue()\n            }\n        });\n    });\n\n//      \n//   \n//             \n//            \n//        \n//           \n                                            \n    DT.Stone = function (options) {\n        var radius, color, x, y, depth, geometry, material,\n            part = Math.random();\n        // \n        if (part >= 0 && part < 0.16) {\n            x = DT.genRandomBetween(-15, -5);\n            y = DT.genRandomBetween(-15, -5);\n        } else if (part >= 0.16 && part < 0.32){\n            x = DT.genRandomBetween(5, 15);\n            y = DT.genRandomBetween(5, 15);\n        } else {\n            x = DT.genRandomBetween(-5, 5);\n            y = DT.genRandomBetween(-5, 5);\n        }\n        //\n        if (Math.abs(x) > 5 || Math.abs(y) > 5) {\n            radius = DT.genRandomBetween(1.5, 3);\n            color = new THREE.Color(0x464451);\n        } else {\n            radius = DT.genRandomBetween(1, 2);\n            depth = DT.genRandomFloorBetween(80, 100) / 255;\n            color = new THREE.Color().setRGB(depth, depth, depth);\n        }\n        geometry = new THREE.IcosahedronGeometry(radius, 0);\n        material = new THREE.MeshPhongMaterial({\n            shading: THREE.FlatShading,\n            color: color,\n            specular: 0x111111,\n            shininess: 100\n        });\n        DT.GameCollectionObject.apply(this, [{\n            geometry: geometry,\n            material: material,\n            THREEConstructor: THREE.Mesh,\n            collection: options.collection\n        }]);\n        this.setParam('position', {\n            x: x,\n            y: y,\n            z: options.spawnCoord\n        })\n        .setParam('rotation', {\n            x: Math.random(),\n            y: Math.random()\n        })\n        .createAndAdd();\n        this.distanceToSphere = null;\n    };\n    DT.Stone.prototype = Object.create(DT.GameCollectionObject.prototype);\n    DT.Stone.prototype.constructor = DT.Stone;\n\n    DT.Stone.prototype.update = function (options) {\n        DT.GameCollectionObject.prototype.update.apply(this, arguments);\n        var el = this.tObject;\n        this.distanceToSphere = el.position.distanceTo(options.sphere.position);\n        this.minDistance = options.sphere.geometry.radius + el.geometry.radius;\n            \n        if (this.distanceToSphere < this.minDistance) {\n            DT.audio.sounds.stoneDestroy.play();\n            DT.sendSocketMessage({\n                type: 'vibr',\n                time: 200\n            });\n            this.removeFromScene();\n\n            $(document).trigger('changeHelth', {delta: -19});\n            //   \n            if (DT.player.isInvulnerability === false) {\n                DT.hit();\n            }\n        }\n        if (this.distanceToSphere > this.minDistance && this.distanceToSphere < this.minDistance + 1 && el.position.z - options.sphere.position.z > 1) {\n            DT.audio.sounds.stoneMiss.play();\n        }\n        if (DT.getDistance(options.sphere.position.x, options.sphere.position.y, el.position.z, el.position.x, el.position.y, el.position.z) < this.minDistance) {\n            el.material.emissive = new THREE.Color().setRGB(\n                el.material.color.r * 0.5,\n                el.material.color.g * 0.5,\n                el.material.color.b * 0.5);\n        } else {\n            el.material.emissive = new THREE.Color().setRGB(0,0,0);\n        }\n        this.updateParam('rotation', {x: 0.014, y: 0.014})\n            .updateParam('position', {z: DT.game.speed.getValue()});\n        return this;\n    };\n\n //      \n//   \n//          \n//         \n//  \n //     \n                              \n    DT.Coin = function (options) {\n        var r = 0.5, i,\n            coin_sides_geo = new THREE.CylinderGeometry( r, r, 0.05, 32, 1, true ),\n            coin_cap_geo = new THREE.Geometry();\n        for (i = 0; i < 100; i++) {\n            var a = i * 1/100 * Math.PI * 2,\n                z = Math.sin(a),\n                xCosA = Math.cos(a),\n                a1 = (i+1) * 1/100 * Math.PI * 2,\n                z1 = Math.sin(a1),\n                x1 = Math.cos(a1);\n            coin_cap_geo.vertices.push(\n                new THREE.Vector3(0, 0, 0),\n                new THREE.Vector3(xCosA*r, 0, z*r),\n                new THREE.Vector3(x1*r, 0, z1*r)\n            );\n            coin_cap_geo.faceVertexUvs[0].push([\n                new THREE.Vector2(0.5, 0.5),\n                new THREE.Vector2(xCosA/2+0.5, z/2+0.5),\n                new THREE.Vector2(x1/2+0.5, z1/2+0.5)\n            ]);\n            coin_cap_geo.faces.push(new THREE.Face3(i*3, i*3+1, i*3+2));\n        }\n        coin_cap_geo.computeCentroids();\n        coin_cap_geo.computeFaceNormals();\n        \n        var coin_cap_texture = THREE.ImageUtils.loadTexture('./img/avers.png'),\n            coin_sides_mat = new THREE.MeshPhongMaterial({emissive: 0xcfb53b, color: 0xcfb53b}),\n            coin_sides = new THREE.Mesh( coin_sides_geo, coin_sides_mat ),\n            coin_cap_mat = new THREE.MeshPhongMaterial({emissive: 0xcfb53b, color: 0xcfb53b, map: coin_cap_texture}),\n            coin_cap_top = new THREE.Mesh( coin_cap_geo, coin_cap_mat ),\n            coin_cap_bottom = new THREE.Mesh( coin_cap_geo, coin_cap_mat );\n\n        coin_cap_top.position.y = 0.05;\n        coin_cap_bottom.position.y = -0.05;\n        coin_cap_top.rotation.x = Math.PI;\n\n        DT.GameCollectionObject.apply(this, [{\n            THREEConstructor: THREE.Object3D,\n            collection: options.collection\n        }]);\n        \n        this.tObject.add(coin_sides);\n        this.tObject.add(coin_cap_top);\n        this.tObject.add(coin_cap_bottom);\n        \n        this.setParam('position', {\n            x: options.x,\n            y: options.y,\n            z: options.z\n        })\n            .setParam('rotation', {\n            x: 1.5,\n            y: 0,\n            z: options.zAngle\n        })\n            .createAndAdd();\n    };\n    DT.Coin.prototype = Object.create(DT.GameCollectionObject.prototype);\n    DT.Coin.prototype.constructor = DT.Coin;\n\n    DT.Coin.prototype.update = function (options) {\n        DT.GameCollectionObject.prototype.update.apply(this, arguments);\n        this.updateParam('rotation', {z: 0.05})\n            .updateParam('position', {z: DT.game.speed.getValue()});\n        var positon = this.tObject.position;\n        var distanceBerweenCenters = positon.distanceTo(options.sphere.position);\n        if (distanceBerweenCenters < 0.9) {\n            this.removeFromScene();\n            $(document).trigger('changeScore', {delta: 1});\n            DT.audio.sounds.catchCoin.play();\n            DT.sendSocketMessage({\n                type: 'vibr',\n                time: 10\n            });\n            $(document).trigger('blink', {color: 0xcfb53b, frames: 60});\n            DT.player.bump();\n        }\n        return this;\n    };\n\n//          \n//      \n//        \n//       \n//  \n//        \n                                            \n    DT.Bonus = function (options) {\n        this.type = DT.genRandomFloorBetween(0, 2);\n        DT.GameCollectionObject.apply(this, [{\n            geometry: DT.listOfModels[this.type].geometry,\n            material: DT.listOfModels[this.type].material,\n            THREEConstructor: THREE.Mesh,\n            collection: options.collection\n        }]);\n        this.setParam('position', {\n                x: options.x,\n                y: options.y,\n                z: options.spawnCoord * 2\n            })\n            .setParam('scale', {\n                x: DT.listOfModels[this.type].scale.x || 1,\n                y: DT.listOfModels[this.type].scale.y || 1,\n                z: DT.listOfModels[this.type].scale.z || 1\n            })\n            .setParam('rotation', {\n                x: DT.listOfModels[this.type].rotation.x || 0,\n                y: DT.listOfModels[this.type].rotation.y || 0,\n                z: DT.listOfModels[this.type].rotation.z || 0\n            })\n            .createAndAdd();\n        // TODO:    \n        if (this.type === 2) {\n            DT.animation = new THREE.MorphAnimation(this.tObject);\n            DT.animation.play();\n        }\n    };\n    DT.Bonus.prototype = Object.create(DT.GameCollectionObject.prototype);\n    DT.Bonus.prototype.constructor = DT.Bonus;\n\n    DT.Bonus.prototype.update = function (options) {\n        var self = this;\n        if (this.type === 0) {\n            this.updateParam('rotation', {z: 0.05});\n        }\n        if (this.type === 1) {\n            this.updateParam('rotation', {z: 0.05});\n        }\n        if (this.type === 2) {\n            // this.updateParam('rotation', {z: 0.05});\n        }\n        \n        this.updateParam('position', {z: DT.game.speed.getValue()});\n        DT.GameCollectionObject.prototype.update.apply(this, arguments);\n        if (DT.getDistance(this.tObject.position.x, this.tObject.position.y, this.tObject.position.z,\n                options.sphere.position.x, options.sphere.position.y, options.sphere.position.z) < 1.0) {\n            \n            if (this.type === 0) {\n                this.tObject.rotation.x += 0.2;\n            }\n            if (this.type === 1) {\n                this.tObject.rotation.y += 0.2;\n            }\n            if (this.type === 2) {\n                // this.tObject.rotation.z += 0.2;\n            }\n            \n            this.tObject.scale.x *= 0.9;\n            this.tObject.scale.y *= 0.9;\n            this.tObject.scale.z *= 0.9;\n            \n            if (DT.getDistance(this.tObject.position.x, this.tObject.position.y, this.tObject.position.z,\n                    options.sphere.position.x, options.sphere.position.y, options.sphere.position.z) < 0.9) {\n                this.removeFromScene();\n                $(document).trigger('catchBonus', {type: self.type});\n            }\n        }\n    };\n\n //                   \n//             \n//                                    \n//                                   \n//        \n //              \n                                                                                \n    DT.Collection = function (options) {\n        this.collection = [];\n        this.constructor = options.constructor;\n    };\n\n    DT.Collection.prototype.createObjects = function (options) {\n        options.number = options.number || 1;\n        options.collection = this.collection;\n        return this;\n    };\n\n    DT.Collection.prototype.update = function (options) {\n        this.collection.forEach(function (el) {\n            el.update(options);\n        });\n        return this;\n    };\n\n    DT.Collection.prototype.removeObjects = function () {\n        this.collection.forEach(function (el) {\n            ei.removeFromScene();\n        });\n        return this;\n    };\n\n    DT.StonesCollection = function () {\n        if (!DT.StonesCollection.__instance) {\n            DT.StonesCollection.__instance = this;\n        } else {\n            return DT.StonesCollection.__instance;\n        }\n        DT.Collection.apply(this, [{\n            constructor: DT.Stone\n        }]);\n    };\n    DT.StonesCollection.prototype = Object.create(DT.Collection.prototype);\n    DT.StonesCollection.prototype.constructor = DT.StonesCollection;\n\n    DT.StonesCollection.prototype.createObjects = function (options) {\n        DT.Collection.prototype.createObjects.apply(this, arguments);\n        var el = this.collection[this.collection.length -1];\n\n        if (el) {\n            var dist = DT.getDistance(0, 0, DT.game.param.spawnCoord,\n                el.tObject.position.x, el.tObject.position.y, el.tObject.position.z);\n            if (dist <= DT.game.param.stonesCloseness) {\n                return this;\n            }\n        }\n        for (var i = 0; i < options.number; i++) {\n            new this.constructor(options);\n        }\n        return this;\n    };\n    $(document).on('update', function (e, data) {\n        new DT.StonesCollection()\n            .createObjects({\n                spawnCoord: DT.game.param.spawnCoord,\n            })\n            .update({\n                dieCoord: DT.game.param.dieCoord,\n                opacityCoord: DT.game.param.opacityCoord,\n                sphere: DT.player.sphere\n            });\n    });\n\n    DT.CoinsCollection = function () {\n        if (!DT.CoinsCollection.__instance) {\n            DT.CoinsCollection.__instance = this;\n        } else {\n            return DT.CoinsCollection.__instance;\n        }\n        DT.Collection.apply(this, [{\n            constructor: DT.Coin\n        }]);\n    };\n    DT.CoinsCollection.prototype = Object.create(DT.Collection.prototype);\n    DT.CoinsCollection.prototype.constructor = DT.CoinsCollection;\n\n    DT.CoinsCollection.prototype.createObjects = function (options) {\n        DT.Collection.prototype.createObjects.apply(this, arguments);\n        if (!this.collection.length) {\n            for (var i = 0; i < options.number; i++) {\n                options.zAngle = i * 0.25;\n                options.z = options.spawnCoord - i * 10;\n                new this.constructor(options);\n            }\n        }\n        return this;\n    };\n    $(document).on('update', function (e, data) {\n        new DT.CoinsCollection()\n            .createObjects({\n                x: DT.genCoord(),\n                y: -2.5,\n                spawnCoord: DT.game.param.spawnCoord,\n                zAngle: 0,\n                number: 10\n            })\n            .update({\n                dieCoord: DT.game.param.dieCoord,\n                opacityCoord: DT.game.param.opacityCoord,\n                sphere: DT.player.sphere\n            });\n    });\n\n    DT.BonusesCollection = function (options) {\n        if (!DT.BonusesCollection.__instance) {\n            DT.BonusesCollection.__instance = this;\n        } else {\n            return DT.BonusesCollection.__instance;\n        }\n        DT.Collection.apply(this, [{\n            constructor: DT.Bonus\n        }]);\n        this.caughtBonuses = [];\n    };\n    DT.BonusesCollection.prototype = Object.create(DT.Collection.prototype);\n    DT.BonusesCollection.prototype.constructor = DT.BonusesCollection;\n\n    DT.BonusesCollection.prototype.createObjects = function (options) {\n        DT.Collection.prototype.createObjects.apply(this, arguments);\n        if (!this.collection.length) {\n            for (var i = 0; i < options.number; i++) {\n                new this.constructor(options);\n            }\n        }\n        return this;\n    };\n    DT.BonusesCollection.prototype.useBonuses = function (type) {\n        // helth\n        if (type === 0) $(document).trigger('changeHelth', {delta: 100});\n        // invulnerability\n        if (type === 1) $(document).trigger('makeInvuler', {});\n        // entertainment\n        if (type === 2) $(document).trigger('makeFun', {});\n        return this;\n    };\n\n    DT.BonusesCollection.prototype.catchBonus = function (type) {\n        var self = this;\n        if (!this.caughtBonuses.length || this.caughtBonuses[0] === type) {\n            this.caughtBonuses.push(type);\n            if (this.caughtBonuses.length === 3) {\n                this.useBonuses(type);\n                var refreshBonus = setTimeout(function() {\n                    self.caughtBonuses.length = 0;\n                    clearTimeout(refreshBonus);\n                }, 100);\n            }\n        } else {\n            this.caughtBonuses.length = 0;\n            this.caughtBonuses.push(type);\n        }\n        $(document).trigger('showBonuses', {caughtBonuses: this.caughtBonuses});\n        return this;\n    };\n    $(document).on('update', function (e, data) {\n        new DT.BonusesCollection()\n            .createObjects({\n                x: DT.genCoord(),\n                y: -2.5,\n                spawnCoord: DT.game.param.spawnCoord,\n            })\n            .update({\n                dieCoord: DT.game.param.dieCoord,\n                opacityCoord: DT.game.param.opacityCoord,\n                sphere: DT.player.sphere\n            });\n    });\n    $(document).on('catchBonus', function (e, data) {\n        new DT.BonusesCollection().catchBonus(data.type);\n    });\n\n //        \n//    \n//         \n//         \n//   \n//        \n                                     \n    // TODO: \n    DT.audio = {\n        frequency: { // for audio visualization\n            0: 400,\n            1: 100\n        },\n        valueAudio: 0,\n        webaudio: new WebAudio(),\n        sounds: {\n            catchCoin: 'sounds/coin.',\n            gameover: 'sounds/gameover.',\n            pause: 'sounds/pause.',\n            stoneDestroy: 'sounds/stoneDestroy.',\n            stoneMiss: 'sounds/stoneMiss.'\n        },\n        music: {\n            0: 'sounds/theField_overTheIce.',\n            1: 'sounds/heart.',\n            2: 'sounds/space_ambient2.',\n            started: [],\n            startedAt: [],\n            pausedAt: [],\n            stopped: [],\n            paused: []\n        }\n    };\n    DT.audio.reset = function () {\n        DT.audio.music.startedAt = [];\n        DT.audio.music.pausedAt = [];\n        DT.audio.music.stopped = [];\n        DT.audio.music.paused = [];\n        DT.audio.music.started = [];\n    };\n\n    DT.setVolume = function (volume) {\n        DT.game.param.globalVolume = volume;\n        if (DT.game.param.prevGlobalVolume !== DT.game.param.globalVolume) {\n            DT.gainNodes.forEach(function(el) {\n                if (el) {\n                    el.gain.value = DT.game.param.globalVolume;\n                }\n            });\n            DT.game.param.prevGlobalVolume = DT.game.param.globalVolume;\n        }\n    };\n\n    $(window).on('focus', function() {\n        if (!DT.game.wasMuted) {\n            DT.setVolume(1);\n        }\n    });\n    $(window).on('blur', function() {\n        if (DT.game.wasStarted && !DT.game.wasPaused && !DT.game.wasOver) {\n            $(document).trigger('pauseGame', {});\n        }\n        DT.setVolume(0);\n    });\n    $(document).on('startGame', function (e, data) {\n        DT.stopSound(2);\n        DT.playSound(0);\n    });\n    $(document).on('pauseGame', function () {\n        DT.stopSoundBeforPause();\n        DT.audio.sounds.pause.play();\n    });\n    $(document).on('resumeGame', function (e, data) {\n        DT.playSoundAfterPause();\n        DT.audio.sounds.pause.play();\n    });\n    $(document).on('gameOver', function (e, data) {\n        DT.stopSound(0);\n        DT.stopSound(1);\n    });\n    $(document).on('gameOver', function (e, data) {\n        DT.audio.sounds.gameover.play();\n    });\n\n        $(function(){\n        // MUSIC\n        var context,\n            counter = 0,\n            buffers = [], sources=[], destination, analysers = [],\n            freqDomain = [];\n        var audio = new Audio();\n        var canPlayOgg = !!audio.canPlayType && audio.canPlayType('audio/ogg; codecs=\\'vorbis\\'') !== '';\n        console.log('canPlayOgg', canPlayOgg);\n        try {\n            window.AudioContext = window.AudioContext || window.webkitAudioContext;\n            context = new AudioContext();\n        }\n        catch(e) {\n            alert('Opps.. Your browser do not support audio API');\n        }\n        DT.stopSound = function(index){\n            if (DT.audio.music.stopped[index] === false) {\n                if (index === 0 || DT.audio.music.paused[index] === false) {\n                    DT.audio.music.pausedAt[index] = Date.now() - DT.audio.music.startedAt[index];\n                } \n                sources[index].stop(index);\n                DT.audio.music.stopped[index] = true;\n                DT.audio.music.started[index] = false;\n            }\n        };\n        DT.gainNodes = [];\n        DT.playSound = function(index){\n            var gainNodes = DT.gainNodes;\n            if (!DT.audio.music.started[index]) {\n                DT.audio.music.started[index] = true;\n                sources[index] = context.createBufferSource();\n                sources[index].loop = true;\n                sources[index].buffer = buffers[index];\n                destination = context.destination;\n                gainNodes[index] = context.createGain();\n                gainNodes[index].gain.value = DT.game.param.globalVolume;\n                analysers[index] = context.createAnalyser();\n                analysers[index].fftSize = 2048;\n                analysers[index].minDecibels = -50;\n                analysers[index].maxDecibels = -20;\n                sources[index].connect(gainNodes[index]);\n                gainNodes[index].connect(analysers[index]);\n                analysers[index].connect(destination);\n                $(document).on('update', function (e, data) {\n                    visualize(index);\n                });\n                DT.audio.music.stopped[index] = false;\n                if (DT.audio.music.pausedAt[index]) {\n                    DT.audio.music.startedAt[index] = Date.now() - DT.audio.music.pausedAt[index];\n                    sources[index].start(index, DT.audio.music.pausedAt[index] / 1000);\n                } else {\n                    DT.audio.music.startedAt[index] = Date.now();\n                    sources[index].start(index);\n                }\n            }\n        };\n        DT.stopSoundBeforPause = function() {\n            DT.audio.music.stopped.forEach(function(el, i) {\n                DT.audio.music.paused[i] = el;\n                DT.stopSound(i);\n            });\n        };\n        DT.playSoundAfterPause = function() {\n            DT.audio.music.paused.forEach(function(el, i) {\n                if (!el) {\n                    DT.playSound(i);\n                }\n            });\n        };\n        var initSound = function(arrayBuffer, bufferIndex) {\n            context.decodeAudioData(arrayBuffer, function(decodedArrayBuffer) {\n                buffers[bufferIndex] = decodedArrayBuffer;\n                console.log('ready sound ' + bufferIndex);\n                counter += 1;\n                yepnope.showLoading(counter);\n            }, function(e) {\n                console.log('Error decoding file', e);\n            });\n        };\n        // SOUNDS\n        var ext = 'ogg';\n        if (!canPlayOgg) {\n            ext = 'mp3';\n        }\n        for (var prop in DT.audio.sounds) if (DT.audio.sounds.hasOwnProperty(prop)) {\n            DT.audio.sounds[prop] = DT.audio.webaudio.createSound().load(DT.audio.sounds[prop] + ext);\n        }\n        var loadSoundFile = function(urlArr, bufferIndex) {\n            var xhr = new XMLHttpRequest();\n            xhr.open('GET', urlArr[bufferIndex] + ext, true);\n            xhr.responseType = 'arraybuffer';\n            xhr.onload = function(e) {\n                initSound(this.response, bufferIndex); // this.response is an ArrayBuffer.\n            };\n            xhr.send();\n        };\n        loadSoundFile(DT.audio.music, 0);\n        loadSoundFile(DT.audio.music, 1);\n        loadSoundFile(DT.audio.music, 2);\n        var visualize = function(index) {\n            freqDomain[index] = new Uint8Array(analysers[index].frequencyBinCount);\n            analysers[index].getByteFrequencyData(freqDomain[index]);\n            DT.audio.valueAudio = getFrequencyValue(DT.audio.frequency[index], index);\n        };\n        var getFrequencyValue = function(frequency, bufferIndex) {\n            var nyquist = context.sampleRate/2,\n                index = Math.round(frequency/nyquist * freqDomain[bufferIndex].length);\n            return freqDomain[bufferIndex][index];\n        };\n        // add update function to webaudio prototype\n        WebAudio.Sound.prototype.update = function() {\n            this.volume(DT.game.param.globalVolume);\n        };\n        WebAudio.Sound.prototype.play = function(time){\n            this.volume(DT.game.param.globalVolume);\n            // handle parameter polymorphism\n            if( time ===  undefined )   time    = 0;\n            // if not yet playable, ignore\n            // - usefull when the sound download isnt yet completed\n            if( this.isPlayable() === false )   return;\n            // clone the bufferSource\n            var clonedNode  = this._chain.cloneBufferSource();\n            // set the noteOn\n            clonedNode.start(time);\n            // create the source object\n            var source  = {\n                node    : clonedNode,\n                stop    : function(time){\n                    if( time ===  undefined )   time    = 0;\n                    this.node.stop(time);\n                    return source;  // for chained API\n                }\n            };\n            // return it\n            return source;\n        };\n    });\n\n//             \n//   \n//           \n//             \n//             \n//                 \n\n    DT.initKeyboardControl = function () {\n        $(document).keydown(function(event) {\n            var k = event.keyCode;\n            // arrows control\n            if (k === 38) {\n                DT.player.changeDestPoint(1, 0);\n            }\n            if (k === 40) {\n                DT.player.changeDestPoint(-1, 0);\n            }\n            if (k === 37) {\n                DT.player.changeDestPoint(0, -1);\n            }\n            if (k === 39) {\n                DT.player.changeDestPoint(0, 1);\n            }\n            // speedUp\n            if (k === 16) { //shift\n                $(document).trigger('stopFun', {});\n                $(document).trigger('changeSpeed', {changer: 36});\n            }\n            if (k === 17) {\n                $(document).trigger('makeFun', {});\n            }\n        });\n        $(document).keyup(function(event) {\n            var k = event.keyCode;\n            if (k === 16) { //shift\n                $(document).trigger('changeSpeed', {changer: 0});\n            }\n        });\n        $(document).keyup(DT.handlers.pauseOnSpace);\n    };\n    \n    $(document).on('startGame', function (e, data) {\n        DT.initKeyboardControl();\n    });\n    $(document).on('gameOver', function (e, data) {\n        $(document).unbind('keyup', DT.handlers.pauseOnSpace);\n        $(document).bind('keyup', DT.handlers.restartOnSpace);\n    });\n\n//      \n//  \n//                  \n//                  \n//         \n//            \n                                                  \n    DT.server = window.location.origin !== 'http://localhost' ? window.location.origin : 'http://192.168.1.36';\n    DT.initSocket = function() {\n        // Game config\n        var leftBreakThreshold = -3,\n            leftTurnThreshold = -20,\n            rightBreakThreshold = 3,\n            rightTurnThreshold = 20,\n            // set socket\n            socket = DT.initSocket.socket = io.connect(DT.server);\n        // When initial welcome message, reply with 'game' device type\n        socket.on('welcome', function(data) {\n            socket.emit('device', {'type':'game', 'cookieUID': DT.getCookie('UID')});\n        });\n        // We receive our game code to show the user\n        socket.on('initialize', function(gameCode) {\n            socket.gameCode = gameCode;\n        });\n        // When the user inputs the code into the phone client,\n        //  we become 'connected'.  Start the game.\n        socket.on('connected', function(data) {\n            $('#gameConnect').hide();\n            $('#status').hide();\n            DT.startAfterChooseControl();\n        });\n            // When the phone is turned, turn the vehicle\n        socket.on('turn', function(turn) {\n            if(turn < leftBreakThreshold) {\n                if(turn > leftTurnThreshold) {\n                    DT.player.destPoint.x = 0;\n                } else {\n                    DT.player.destPoint.x = -DT.game.param.spacing;\n                }\n            } else if (turn > rightBreakThreshold) {\n                if(turn < rightTurnThreshold) {\n                    DT.player.destPoint.x = 0;\n                } else {\n                    DT.player.destPoint.x = DT.game.param.spacing;\n                }\n            } else {\n                DT.player.destPoint.x = 0;\n            }\n        });\n        socket.on('click', function(click) {\n            DT.handlers[click]();\n        });\n    };\n    DT.sendSocketMessage = function (options) {\n        var data = {\n            'type': options.type,\n            'time': options.time,\n            'gameCode': DT.initSocket.socket.gameCode,\n            'sessionid': DT.initSocket.socket.socket.sessionid,\n            'coinsCollect': DT.player.currentScore\n        };\n        if (DT.initSocket.socket) {\n            DT.initSocket.socket.emit('message', data);\n        }\n    };\n\n    $(document).on('startGame', function (e, data) {\n        DT.sendSocketMessage('gamestarted');\n    });\n    $(document).on('gameOver', function (e, data) {\n        DT.sendSocketMessage('gameover');\n    });\n\n//            \n//       \n//           \n//           \n//   \n//         \n\n    DT.initPhoneControl = function() {\n        $('.message').html('Please open <span style=\\'color: red\\'>' + DT.server +'/m</span> with your phone and enter code <span style=\\'font-weight:bold; color: red\\' id=\\'socketId\\'></span>');\n        $('#socketId').html(DT.initSocket.socket.gameCode);\n    };\n\n//            \n//      \n//          \n//        \n//     \n //           \n    // headtracker realization\n    // DT.enableWebcam = function () {\n        // // Game config\n        // var leftBreakThreshold = -5;\n        // var leftTurnThreshold = -10;\n        // var rightBreakThreshold = 5;\n        // var rightTurnThreshold = 10;\n        // //   video  canvas\n        \n                // var videoInput = document.getElementById('vid');\n        // var canvasInput = document.getElementById('compare');\n        // var debugOverlay = document.getElementById('debug');\n    \n            // var canvasContext = canvasInput.getContext('2d');\n        // //  canvas   \n        // canvasContext.translate(canvasInput.width, 0);\n        // canvasContext.scale(-1, 1);\n    \n            // debugOverlay.style.height = '100%';\n        // debugOverlay.style.opacity = '0.1';\n        // debugOverlay.style.zIndex = '0';\n        \n                // //  ,  \n        \n                // statusMessages = {\n        //     'whitebalance' : '    ',\n        //     'detecting' : ' ',\n        //     'hints' : '-  ,  .    ',\n        //     'redetecting' : ' , ..',\n        //     'lost' : ' ',\n        //     'found' : '  '\n        // };\n        \n                // supportMessages = {\n        //     'no getUserMedia' : '   getUserMedia',\n        //     'no camera' : '  .'\n        // };\n        \n                // document.addEventListener('headtrackrStatus', function(event) {\n        //     if (event.status in supportMessages) {\n        //         console.log(supportMessages[event.status]);\n        //         $('.message').html(supportMessages[event.status])\n        //     } else if (event.status in statusMessages) {\n        //         console.log(statusMessages[event.status]);\n        //         $('.message').html(statusMessages[event.status])\n        //     }\n        //     if (event.status === 'found' && !DT.game.wasStarted) {\n                // DT.startAfterChooseControl();\n        //     }\n        // }, true);\n        \n                // //  \n        \n                // var htracker = new headtrackr.Tracker({altVideo : {ogv : '', mp4 : ''}, calcAngles : true, ui : false, headPosition : false, debug : debugOverlay});\n        // htracker.init(videoInput, canvasInput);\n        // htracker.start();\n        \n                // //     \n        \n                // document.addEventListener('facetrackingEvent', function( event ) {\n        //     // once we have stable tracking, draw rectangle\n        //     if (event.detection == 'CS') {\n        //         var angle = Number(event.angle *(180/ Math.PI)-90);\n        //         // console.log(angle);\n        //         if(angle < leftBreakThreshold) {\n        //             if(angle > leftTurnThreshold) {\n        //                 DT.player.destPoint.x = 0;\n        //             } else {\n        //                 DT.player.destPoint.x = -DT.game.param.spacing;\n        //             }\n        //         } else if (angle > rightBreakThreshold) {\n        //             if(angle < rightTurnThreshold) {\n        //                 DT.player.destPoint.x = 0;\n        //             } else {\n        //                 DT.player.destPoint.x = DT.game.param.spacing;\n        //             }\n        //         } else {\n        //             DT.player.destPoint.x = 0;\n        //         }\n        //     }\n        // });\n    // };\n\n //                   \n//            \n//                      \n//                    \n//              \n//                     \n\n    // virtual button realization\n    DT.enableWebcam = function () {\n        navigator.getUserMedia = navigator.getUserMedia ||\n            navigator.webkitGetUserMedia ||\n            navigator.mozGetUserMedia;\n        window.URL = window.URL || window.webkitURL;\n        \n        var camvideo = document.getElementById('vid');\n\n        if (!navigator.getUserMedia) {\n            $('.message').html('Sorry. <code>navigator.getUserMedia()</code> is not available.');\n        }\n        navigator.getUserMedia({video: true}, gotStream, noStream);\n        \n        function gotStream(stream) {\n            if (window.URL) {\n                camvideo.src = window.URL.createObjectURL(stream);\n            } \n            else { // Opera\n                camvideo.src = stream;\n            }\n            camvideo.onerror = function(e) {\n                stream.stop();\n            };\n            stream.onended = noStream;\n            //start game\n            DT.startAfterChooseControl();\n        }\n        \n        function noStream(e) {\n            var msg = 'No camera available.';\n            if (e.code == 1) \n            {   msg = 'User denied access to use camera.';   }\n            console.log(msg);\n        }\n        \n        // assign global variables to HTML elements\n        console.log(window.innerHeight, window.innerWidth);\n        var video = document.getElementById( 'vid' );\n        var videoCanvas = document.getElementById( 'debug' );\n        var videoContext = videoCanvas.getContext( '2d' );\n        $('#debug').css({\n            'height': window.innerHeight,\n            'width': window.innerWidth,\n            'opacity': 0.2\n        });\n        \n        var blendCanvas  = document.getElementById( 'compare' );\n        var blendContext = blendCanvas.getContext('2d');\n        $('#compare').css({\n            'height': window.innerHeight,\n            'width': window.innerWidth,\n            'opacity': 0.2\n        });\n        \n        $('.cam').css({\n            'background-color': 'rgba(255,255,255,0.2)'\n        });\n        $('.center').css({\n            'background-color': 'rgba(0,0,0,0.2)',\n            'width': '33%',\n            'height': '100%',\n            'margin-left': '33%'\n        });\n        \n        // these changes are permanent\n        videoContext.translate(320, 0);\n        videoContext.scale(-1, 1);\n        \n        // background color if no video present\n        videoContext.fillStyle = '#005337';\n        videoContext.fillRect( 0, 0, videoCanvas.width, videoCanvas.height );\n        \n        var buttons = [];\n        \n        var button1 = new Image();\n        button1.src ='img/lr.png';\n        var buttonData1 = { name:'left', image:button1, x:0, y:0, w:100, h:240, coord: -DT.game.param.spacing };\n        buttons.push( buttonData1 );\n        \n            var button2 = new Image();\n        button2.src ='img/lr.png';\n        var buttonData2 = { name:'right', image:button2, x:220, y:0, w:100, h:240, coord: DT.game.param.spacing };\n        buttons.push( buttonData2 );\n        \n        var button3 = new Image();\n        button3.src ='img/c.png';\n        var buttonData3 = { name:'center', image:button3, x:100, y:0, w:120, h:240, coord: 0 };\n        buttons.push( buttonData3 );\n        \n        // start the loop\n        $(document).on('update', function (e, data) {\n            render();\n            blend();\n            checkAreas();\n        });\n        \n        function render() { \n            if ( video.readyState === video.HAVE_ENOUGH_DATA ) {\n                // mirror video\n                videoContext.drawImage( video, 0, 0, videoCanvas.width, videoCanvas.height );\n            }\n        }\n        var lastImageData;\n        function blend() {\n            var width  = videoCanvas.width;\n            var height = videoCanvas.height;\n            // get current webcam image data\n            var sourceData = videoContext.getImageData(0, 0, width, height);\n            // create an image if the previous image doesn't exist\n            if (!lastImageData) lastImageData = videoContext.getImageData(0, 0, width, height);\n            // create a ImageData instance to receive the blended result\n            var blendedData = videoContext.createImageData(width, height);\n            // blend the 2 images\n            differenceAccuracy(blendedData.data, sourceData.data, lastImageData.data);\n            // draw the result in a canvas\n            blendContext.putImageData(blendedData, 0, 0);\n            // store the current webcam image\n            lastImageData = sourceData;\n        }\n        function differenceAccuracy(target, data1, data2) {\n            if (data1.length != data2.length) return null;\n            var i = 0;\n            while (i < (data1.length * 0.25)) {\n                var average1 = (data1[4*i] + data1[4*i+1] + data1[4*i+2]) / 3;\n                var average2 = (data2[4*i] + data2[4*i+1] + data2[4*i+2]) / 3;\n                var diff = threshold(fastAbs(average1 - average2));\n                target[4*i]   = diff;\n                target[4*i+1] = diff;\n                target[4*i+2] = diff;\n                target[4*i+3] = 0xFF;\n                ++i;\n            }\n        }\n        function fastAbs(value) {\n            return (value ^ (value >> 31)) - (value >> 31);\n        }\n        function threshold(value) {\n            return (value > 0x15) ? 0xFF : 0;\n        }\n        \n            // check if white region from blend overlaps area of interest (e.g. handlers)\n        function checkAreas() {\n            var b, l = buttons.length;\n            for (b = 0; b < l; b++) {\n                // get the pixels in a note area from the blended image\n                // calculate the average lightness of the blended data\n                var blendedData = blendContext.getImageData( buttons[b].x, buttons[b].y, buttons[b].w, buttons[b].h ),\n                    i = 0,\n                    sum = 0,\n                    countPixels = blendedData.data.length * 0.25;\n                while (i < countPixels) {\n                    sum += (blendedData.data[i*4] + blendedData.data[i*4+1] + blendedData.data[i*4+2]);\n                    ++i;\n                }\n                // calculate an average between of the color values of the note area [0-255]\n                var average = Math.round(sum / (3 * countPixels));\n                // more than 20% movement detected\n                if (average > 30) {\n                    console.log( 'Button ' + buttons[b].name + ' triggered.' ); // do stuff\n                    // messageArea.innerHTML = '<font size='+4' color=white>'+ buttons[b].name + '</b></font>';\n                    DT.player.destPoint.x = buttons[b].coord;\n                }\n            }\n        }\n    };\n\n//          \n//        \n//                 \n//                \n//          \n//           \n\n    $(document).on('showFun', function (e, data) {\n        if (data.isFun) {\n            $(document).trigger('changeSpeed', {changer: -18});\n            DT.stopSound(0);\n            DT.playSound(1);\n        } else {\n            $(document).trigger('changeSpeed', {changer: 0});\n            DT.stopSound(1);\n            DT.playSound(0);\n        }\n    });\n    $(document).on('resetGame', function (e, data) {\n\n    });\n\n//               \n//          \n//           \n//          \n//        \n//          \n\n    DT.handlers = {};\n    DT.handlers.startOnSpace = function(event) {\n        var k = event.keyCode;\n        if (k === 32) {\n            DT.startAfterChooseControl();\n        }\n    };\n    DT.handlers.pauseOnSpace = function(event) {\n        var k = event.keyCode;\n        if (k === 32) {\n            DT.handlers.pause();\n        }\n    };\n    DT.handlers.restartOnSpace = function(event) {\n        var k = event.keyCode;\n        if (k === 32) {\n            DT.handlers.restart();\n        }\n    };\n    DT.handlers.fullscreen = function () {\n        var isActivated = THREEx.FullScreen.activated();\n        if (isActivated) {\n            THREEx.FullScreen.cancel();\n        } else {\n            THREEx.FullScreen.request(document.body);\n        }\n    };\n    DT.handlers.pause = function () {\n        if (DT.game.wasPaused) {\n            $(document).trigger('resumeGame', {});\n        } else {\n            $(document).trigger('pauseGame', {});\n        }\n    };\n    DT.handlers.mute = function() {\n        if (DT.game.param.globalVolume === 1) {\n            DT.setVolume(0);\n            $('.music_button').html('N');\n            DT.game.wasMuted = true;\n        } else {\n            DT.setVolume(1);\n            $('.music_button').html('M');\n            DT.game.wasMuted = false;\n        }\n    };\n    DT.handlers.left = function () {\n        DT.player.changeDestPoint(0, -1);\n    };\n    DT.handlers.right = function () {\n        DT.player.changeDestPoint(0, 1);\n    };\n    DT.handlers.restart = function () {\n        DT.game.reset();\n        DT.player.reset();\n        $('.current_coins').html('0');\n        $('.bonus').html('');\n        $('.gameTimer').html('0:00');\n        $('.helth').css({width: '100%'});\n        $('.game_over').hide();\n        $(document).bind('keyup', DT.handlers.pauseOnSpace);\n        $(document).unbind('keyup', DT.handlers.restartOnSpace);\n        $('#one_more_time').unbind('click');\n        DT.audio.reset();\n        $(document).trigger('startGame', {});\n        DT.playSound(0);\n    };\n\n//        \n//   \n//                   \n//                  \n//                 \n//                   \n                                                                      \n    DT.runApp = function () {\n        DT.initSocket();\n        DT.playSound(2);\n        $(function() {\n            $('.loader').fadeOut(250);\n            $('.choose_control').css({'display': 'table', 'opacity': '0'}).animate({'opacity': '1'}, 250);\n            $(document).keyup(DT.handlers.startOnSpace);\n            $('.choose_wasd').click(function() {\n                DT.startAfterChooseControl();\n            });\n            $('.choose_mobile').click(function() {\n                DT.initPhoneControl();\n            });\n            $('.choose_webcam').click(function() {\n                DT.enableWebcam();\n            });\n        });\n    };\n    DT.startAfterChooseControl = function () {\n        if (!DT.game.wasStarted) {\n            $(document).trigger('startGame', {});\n        }\n        $(document).unbind('keyup',DT.handlers.startOnSpace);\n    };\n    DT.hit = function() {\n        $(function(){\n            $('.error').html('ERROR ' + DT.genRandomFloorBetween(500, 511));\n            $('.hit').css({'display': 'table'}).fadeOut(250);\n        });\n    };\n\n    $('.menu_button').click(function() {\n        $(document).trigger('pauseGame', {});\n    });\n    $('.resume').click(function() {\n        $(document).trigger('resumeGame', {});\n    });\n    $('.music_button').click(DT.handlers.mute);\n    $('.fs_button').click(DT.handlers.fullscreen);\n    $(document).keyup(function(event) {\n        var k = event.keyCode;\n        if (k === 77) {\n            DT.handlers.mute();\n        }\n    });\n    $(document).keyup(function(event) {\n        var k = event.keyCode;\n        if (k === 70) {\n            DT.handlers.fullscreen();\n        }\n    });\n\n    $(document).on('startGame', function (e, data) {\n        $('.choose_control').fadeOut(250);\n    });\n    $(document).on('pauseGame', function () {\n        $('.menu_page').css({'display': 'table'});\n    });\n    $(document).on('resumeGame', function (e, data) {\n        $('.menu_page').css({'display': 'none'});\n    });\n    $(document).on('startGame', function (e, data) {\n        $('.gameTimer').css({'display': 'block'});\n    });\n    $(document).on('showScore', function (e, data) {\n        $('.current_coins').text(data.score);\n    });\n    $(document).on('showHelth', function (e, data) {\n        $('.helth').animate({width: data.helth + '%'});\n    });\n    $(document).on('showBonuses', function (e, data) {\n        $('.bonus').text(data.caughtBonuses.join(' '));\n        if (data.caughtBonuses.length === 3) {\n            $('.bonus').fadeOut(300, function(){\n                $('.bonus').text('').fadeIn(100);\n            });\n        }\n    });\n    $(document).on('gameOver', function (e, data) {\n        $('.total_coins').text(DT.player.currentScore);\n        $('.game_over').css({'display': 'table', 'opacity': '0'}).animate({'opacity': '1'}, 1000);\n        $('#one_more_time').click(function () {\n            DT.handlers.restart();\n        });\n    });\n\n//   \n// \n//             \n//             \n//               \n//               \n\n    DT.setStats = function () {\n        var body = document.getElementsByTagName('body')[0];\n        DT.stats = DT.stats|| new Stats();\n        DT.stats.domElement.style.position = 'absolute';\n        DT.stats.domElement.style.top = '0px';\n        DT.stats.domElement.style.zIndex = 100;\n        body.appendChild( DT.stats.domElement );\n        DT.stats2 = DT.stats2 || new Stats();\n        DT.stats2.setMode(1); // 0: fps, 1: ms\n        DT.stats2.domElement.style.position = 'absolute';\n        DT.stats2.domElement.style.top = '0px';\n        DT.stats2.domElement.style.left = '80px';\n        DT.stats2.domElement.style.zIndex = 100;\n        body.appendChild( DT.stats2.domElement );\n    };\n    $(document).on('startGame', function (e, data) {\n        DT.setStats();\n    });\n    $(document).on('update', function (e, data) {\n        DT.stats.update();\n        DT.stats2.update();\n    });\n\n//           \n//         \n   //               \n   //              \n   //           \n   //             \n\n    return DT;\n} ());\n\n//# sourceMappingURL=DT.js.map"]}